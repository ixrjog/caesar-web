(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-db72eeda"],{5672:function(e,t,n){},"65ce":function(e,t,n){"use strict";n.d(t,"j",(function(){return r})),n.d(t,"o",(function(){return o})),n.d(t,"w",(function(){return s})),n.d(t,"a",(function(){return l})),n.d(t,"v",(function(){return c})),n.d(t,"f",(function(){return u})),n.d(t,"k",(function(){return p})),n.d(t,"c",(function(){return d})),n.d(t,"r",(function(){return m})),n.d(t,"l",(function(){return f})),n.d(t,"e",(function(){return g})),n.d(t,"m",(function(){return b})),n.d(t,"i",(function(){return h})),n.d(t,"b",(function(){return v})),n.d(t,"q",(function(){return y})),n.d(t,"g",(function(){return O})),n.d(t,"t",(function(){return j})),n.d(t,"x",(function(){return S})),n.d(t,"p",(function(){return k})),n.d(t,"n",(function(){return w})),n.d(t,"d",(function(){return I})),n.d(t,"s",(function(){return _})),n.d(t,"h",(function(){return x})),n.d(t,"u",(function(){return P}));var a=n("9bd2"),i="/application";function r(e){return Object(a["a"])({url:i+"/page/query",method:"post",data:e})}function o(e){return Object(a["a"])({url:i+"/my/page/query",method:"post",data:e})}function s(e){return Object(a["a"])({url:i+"/my/rate/update",method:"put",data:e})}function l(e){return Object(a["a"])({url:i+"/add",method:"post",data:e})}function c(e){return Object(a["a"])({url:i+"/update",method:"put",data:e})}function u(e){return Object(a["a"])({url:i+"/del?id="+e,method:"delete"})}function p(e){return Object(a["a"])({url:i+"/scm/member/query?applicationId="+e,method:"get"})}function d(e,t){return Object(a["a"])({url:i+"/scm/member/add?applicationId="+e+"&projectId="+t,method:"put"})}function m(e){return Object(a["a"])({url:i+"/scm/member/remove?id="+e,method:"delete"})}function f(e){return Object(a["a"])({url:i+"/scm/member/branch/query",method:"post",data:e})}function g(e){return Object(a["a"])({url:i+"/scm/member/branch/create",method:"post",data:e})}function b(e){return Object(a["a"])({url:i+"/scm/member/branch/commit/query",method:"post",data:e})}function h(e){return Object(a["a"])({url:i+"/engine/query?applicationId="+e,method:"get"})}function v(e,t){return Object(a["a"])({url:i+"/engine/add?applicationId="+e+"&jenkinsInstanceId="+t,method:"put"})}function y(e){return Object(a["a"])({url:i+"/engine/remove?id="+e,method:"delete"})}function O(e,t){return Object(a["a"])({url:i+"/user/grant?applicationId="+e+"&userId="+t,method:"put"})}function j(e,t){return Object(a["a"])({url:i+"/user/revoke?applicationId="+e+"&userId="+t,method:"delete"})}function S(e,t){return Object(a["a"])({url:i+"/user/permission/update?applicationId="+e+"&userId="+t,method:"put"})}function k(e){return Object(a["a"])({url:i+"/server/group/page/query",method:"post",data:e})}function w(e){return Object(a["a"])({url:i+"/server/group/query?applicationId="+e,method:"get"})}function I(e){return Object(a["a"])({url:i+"/server/group/add",method:"put",data:e})}function _(e){return Object(a["a"])({url:i+"/server/group/remove?id="+e,method:"delete"})}function x(e,t){return Object(a["a"])({url:i+"/build/job/user/grant?ciJobId="+e+"&userId="+t,method:"put"})}function P(e,t){return Object(a["a"])({url:i+"/build/job/user/revoke?ciJobId="+e+"&userId="+t,method:"delete"})}},7648:function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"d",(function(){return o})),n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return l}));var a=n("9bd2"),i="/user/application";function r(e){return Object(a["a"])({url:i+"/exclude/page/query",method:"post",data:e})}function o(e){return Object(a["a"])({url:i+"/include/page/query",method:"post",data:e})}function s(e){return Object(a["a"])({url:i+"/build/job/exclude/page/query",method:"post",data:e})}function l(e){return Object(a["a"])({url:i+"/build/job/include/page/query",method:"post",data:e})}},"7d80":function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return o})),n.d(t,"e",(function(){return s})),n.d(t,"b",(function(){return l})),n.d(t,"d",(function(){return c}));var a=n("9bd2"),i="/jenkins/instance";function r(e){return Object(a["a"])({url:i+"/page/query",method:"post",data:e})}function o(e){return Object(a["a"])({url:i+"/add",method:"post",data:e})}function s(e){return Object(a["a"])({url:i+"/update",method:"put",data:e})}function l(e){return Object(a["a"])({url:i+"/del?id="+e,method:"delete"})}function c(e){return Object(a["a"])({url:i+"/active/set?id="+e,method:"get"})}},"81ce":function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{title:e.title,visible:e.formStatus.visible,"before-close":e.closeDialog},on:{"update:visible":function(t){return e.$set(e.formStatus,"visible",t)}}},[n("div",{staticStyle:{"margin-bottom":"5px"}},[n("el-row",{staticStyle:{"margin-bottom":"5px"},attrs:{gutter:24}},[n("el-select",{staticStyle:{display:"inline-block","max-width":"200px","margin-left":"10px"},attrs:{filterable:"",clearable:"",remote:"","reserve-keyword":"",placeholder:"输入关键词搜索用户","remote-method":e.getUser,loading:e.searchLoading},model:{value:e.userId,callback:function(t){e.userId=t},expression:"userId"}},e._l(e.userOptions,(function(t){return n("el-option",{key:t.id,attrs:{label:t.username,value:t.id}},[n("span",{staticStyle:{float:"left"}},[e._v(e._s(t.username))]),n("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px","margin-left":"10px"}},[e._v(e._s(t.displayName))])])})),1),n("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"success",disabled:""===e.userId,plain:"",size:"mini"},on:{click:function(t){return e.grantUser()}}},[e._v("授权 ")])],1)],1),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData}},[n("el-table-column",{attrs:{prop:"username",label:"用户名"}}),n("el-table-column",{attrs:{prop:"displayName",label:"显示名"}}),n("el-table-column",{attrs:{prop:"email",label:"邮箱"}}),n("el-table-column",{attrs:{label:"角色"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-tag",{attrs:{type:"ADMIN"===t.row.userPermission.roleName?"danger":"success",size:"small"}},[e._v(" "+e._s("ADMIN"===t.row.userPermission.roleName?"管理员":"用户")+" ")])]}}])}),n("el-table-column",{attrs:{fixed:"right",label:"操作",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:function(n){return e.handlerRowUpdatePermission(t.row)}}},[e._v(e._s("ADMIN"===t.row.userPermission.roleName?"降权":"提权"))]),n("el-button",{attrs:{type:"danger",plain:"",size:"mini"},on:{click:function(n){return e.handlerRowRevokeUser(t.row)}}},[e._v("撤销")])]}}])})],1),n("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:e.pagination.total,"current-page":e.pagination.currentPage,"page-size":e.pagination.pageSize},on:{"current-change":e.paginationCurrentChange}}),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{size:"mini"},on:{click:function(t){e.formStatus.visible=!1}}},[e._v("关闭")])],1)],1)},i=[],r=n("7648"),o=n("65ce"),s={data:function(){return{title:"应用授权管理",application:{},tableData:[],loading:!1,searchLoading:!1,userId:"",userOptions:[],pagination:{currentPage:1,pageSize:10,total:0},queryParam:{queryName:""}}},name:"ApplicationPermissionDialog",props:["formStatus"],mixins:[],mounted:function(){},methods:{initData:function(e){this.application=e,this.userId="",this.pagination.currentPage=1,this.getUser(""),this.fetchData()},getUser:function(e){var t=this;this.searchLoading=!0;var n={queryName:e,applicationId:this.application.id,page:1,length:10};Object(r["c"])(n).then((function(e){t.userOptions=e.body.data,t.searchLoading=!1}))},closeDialog:function(){this.formStatus.visible=!1},handleClick:function(){this.$emit("input",!this.value)},grantUser:function(){var e=this;setTimeout((function(){Object(o["g"])(e.application.id,e.userId).then((function(t){e.$message({message:"成功",type:"success"}),e.userId="",e.getUser(""),e.fetchData()}))}),30)},handlerRowUpdatePermission:function(e){var t=this;setTimeout((function(){Object(o["x"])(t.application.id,e.id).then((function(e){t.$message({message:"成功",type:"success"}),t.userId="",t.getUser(""),t.fetchData()}))}),30)},handlerRowRevokeUser:function(e){var t=this;setTimeout((function(){Object(o["t"])(t.application.id,e.id).then((function(e){t.$message({message:"成功",type:"success"}),t.getUser(""),t.fetchData()}))}),30)},paginationCurrentChange:function(e){this.pagination.currentPage=e,this.fetchData()},fetchData:function(){var e=this;this.loading=!0;var t={queryName:this.queryParam.queryName,applicationId:this.application.id,page:this.pagination.currentPage,length:this.pagination.pageSize};Object(r["d"])(t).then((function(t){e.tableData=t.body.data,e.pagination.total=t.body.totalNum,e.loading=!1}))}}},l=s,c=n("2877"),u=function(e){e.options.__source="src/components/opscloud/application/ApplicationPermissionDialog.vue"},p=u,d=Object(c["a"])(l,a,i,!1,null,null,null);"function"===typeof p&&p(d);t["a"]=d.exports},"8b7e":function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return s}));var a=n("9bd2"),i="/gitlab/project";function r(e){return Object(a["a"])({url:i+"/page/query",method:"post",data:e})}function o(e){return Object(a["a"])({url:i+"/del?id="+e,method:"delete"})}function s(e){return Object(a["a"])({url:i+"/sync?instanceId="+e,method:"get"})}},a3e9:function(e,t,n){"use strict";n.d(t,"d",(function(){return i})),n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o})),n.d(t,"e",(function(){return s})),n.d(t,"f",(function(){return l})),n.d(t,"c",(function(){return c}));var a=n("9bd2");function i(e,t,n){return Object(a["a"])({url:"/tag/page/query?tagKey="+e+"&page="+t+"&length="+n,method:"get"})}function r(e){return Object(a["a"])({url:"/tag/add",method:"post",data:e})}function o(e){return Object(a["a"])({url:"/tag/del?id="+e,method:"delete"})}function s(e){return Object(a["a"])({url:"/tag/update",method:"put",data:e})}function l(e){return Object(a["a"])({url:"/tag/business/update",method:"put",data:e})}function c(e,t,n){return Object(a["a"])({url:"/tag/business/query?businessType="+e+"&businessId="+t+"&tagKey="+n,method:"get"})}},b3eb:function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{title:e.formStatus.operationType?e.formStatus.addTitle:e.formStatus.updateTitle,visible:e.formStatus.visible},on:{"update:visible":function(t){return e.$set(e.formStatus,"visible",t)}}},[n("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[n("el-tab-pane",{attrs:{label:"应用配置",name:"application"}},[n("el-form",{attrs:{model:e.application}},[n("el-form-item",{attrs:{label:"应用名称","label-width":e.labelWidth,required:!0}},[n("el-input",{attrs:{placeholder:"请输入内容"},model:{value:e.application.name,callback:function(t){e.$set(e.application,"name",t)},expression:"application.name"}})],1),n("el-form-item",{attrs:{label:"应用key","label-width":e.labelWidth,required:!0}},[n("el-input",{attrs:{placeholder:"请输入内容",disabled:!e.formStatus.operationType},model:{value:e.application.applicationKey,callback:function(t){e.$set(e.application,"applicationKey",t)},expression:"application.applicationKey"}},[n("template",{slot:"append"},[n("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.handlerBuildKey}},[n("i",{staticClass:"fa fa-arrow-up",attrs:{"aria-hidden":"true"}})])],1)],2)],1),n("el-form-item",{attrs:{label:"GitFlow","label-width":e.labelWidth}},[n("el-checkbox",{model:{value:e.application.enableGitflow,callback:function(t){e.$set(e.application,"enableGitflow",t)},expression:"application.enableGitflow"}},[e._v("启用")])],1),n("el-form-item",{attrs:{label:"描述","label-width":e.labelWidth}},[n("el-input",{attrs:{placeholder:"请输入内容"},model:{value:e.application.comment,callback:function(t){e.$set(e.application,"comment",t)},expression:"application.comment"}})],1)],1)],1),""!==e.application.id?n("el-tab-pane",{attrs:{label:"SCM配置",name:"scm"}},[n("el-row",{staticStyle:{"margin-bottom":"5px","margin-left":"0px"},attrs:{gutter:24}},[n("el-select",{staticClass:"select",attrs:{filterable:"",clearable:"",remote:"","reserve-keyword":"",placeholder:"搜索实例","remote-method":e.getGitlabInstance},on:{change:e.handlerSelGitlabInstance},model:{value:e.queryGitlabParam.instanceId,callback:function(t){e.$set(e.queryGitlabParam,"instanceId",t)},expression:"queryGitlabParam.instanceId"}},e._l(e.gitlabInstanceOptions,(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1),n("el-select",{staticClass:"select",attrs:{filterable:"",clearable:"",disabled:""===e.queryGitlabParam.instanceId,remote:"","reserve-keyword":"",placeholder:"搜索项目","remote-method":e.getProject},model:{value:e.projectId,callback:function(t){e.projectId=t},expression:"projectId"}},e._l(e.projectOptions,(function(t){return n("el-option",{key:t.id,attrs:{label:t.name,value:t.id}},[n("span",{staticStyle:{float:"left","margin-right":"15px"}},[e._v(e._s(t.name))]),n("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.sshUrl))])])})),1),n("el-button",{attrs:{size:"mini",type:"primary",disabled:""===e.projectId},on:{click:e.handlerScmMemberAdd}},[e._v("添加")])],1),n("el-row",{staticStyle:{"margin-bottom":"5px","margin-left":"5px"},attrs:{gutter:24}},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.scmMemberLoading,expression:"scmMemberLoading"}],staticStyle:{width:"100%"},attrs:{data:e.scmMembers}},[n("el-table-column",{attrs:{prop:"scmType",label:"SCM类型",width:"100"}}),n("el-table-column",{attrs:{prop:"scmSshUrl",label:"sshUrl",width:"300"}}),n("el-table-column",{attrs:{prop:"tags",label:"标签"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",{staticClass:"tag-group"},e._l(t.row.tags,(function(t){return n("span",{key:t.id},[n("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:t.comment,placement:"top-start"}},[n("el-tag",{staticStyle:{"margin-left":"5px"},style:{color:t.color}},[e._v(e._s(t.tagKey))])],1)],1)})),0)]}}],null,!1,726257749)}),n("el-table-column",{attrs:{prop:"comment",label:"描述"}}),n("el-table-column",{attrs:{fixed:"right",label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"danger",plain:"",size:"mini"},on:{click:function(n){return e.handlerScmMemberRowRemove(t.row)}}},[e._v("移除")])]}}],null,!1,1935080429)})],1)],1)],1):e._e(),""!==e.application.id?n("el-tab-pane",{attrs:{label:"服务器组(可选)",name:"serverGroup"}},[n("el-row",{staticStyle:{"margin-bottom":"5px","margin-left":"0px"},attrs:{gutter:24}},[n("el-select",{staticClass:"select",attrs:{filterable:"",clearable:"","reserve-keyword":""},model:{value:e.sourceType,callback:function(t){e.sourceType=t},expression:"sourceType"}},e._l(e.sourceTypeOptions,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),n("el-select",{staticClass:"select",attrs:{filterable:"",clearable:"","value-key":"id",remote:"","reserve-keyword":"",placeholder:"搜索服务器组","remote-method":e.getServerGroup},model:{value:e.serverGroup,callback:function(t){e.serverGroup=t},expression:"serverGroup"}},e._l(e.serverGroupOptions,(function(t){return n("el-option",{key:t.id,attrs:{label:t.name,value:t}},[n("span",{staticStyle:{float:"left","margin-right":"15px"}},[e._v(e._s(t.name))]),n("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.comment))])])})),1),n("el-button",{attrs:{size:"mini",type:"primary",disabled:""===e.serverGroup},on:{click:e.handlerServerGroupAdd}},[e._v("添加 ")])],1),n("el-row",{staticStyle:{"margin-bottom":"5px","margin-left":"5px"},attrs:{gutter:24}},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.applicationServerGroupLoading,expression:"applicationServerGroupLoading"}],staticStyle:{width:"100%"},attrs:{data:e.serverGroups}},[n("el-table-column",{attrs:{prop:"source",label:"数据源",width:"100"}}),n("el-table-column",{attrs:{prop:"serverGroupName",label:"服务器组名称",width:"300"}}),n("el-table-column",{attrs:{prop:"comment",label:"描述"}}),n("el-table-column",{attrs:{fixed:"right",label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"danger",plain:"",size:"mini"},on:{click:function(n){return e.handlerServerGroupRowRemove(t.row)}}},[e._v("移除 ")])]}}],null,!1,142187386)})],1)],1)],1):e._e(),""!==e.application.id?n("el-tab-pane",{attrs:{label:"工作引擎",name:"engine"}},[n("el-row",{staticStyle:{"margin-bottom":"5px","margin-left":"0px"},attrs:{gutter:24}},[n("el-select",{staticClass:"select",attrs:{clearable:"",placeholder:"引擎类型"},on:{change:e.handlerSelEngineType},model:{value:e.application.engineType,callback:function(t){e.$set(e.application,"engineType",t)},expression:"application.engineType"}},e._l(e.engineTypeOptions,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),n("el-select",{directives:[{name:"show",rawName:"v-show",value:1===e.application.engineType,expression:"application.engineType === 1"}],staticClass:"select",attrs:{filterable:"",clearable:"",remote:"","reserve-keyword":"",placeholder:"搜索实例","remote-method":e.getJenkinsInstance},model:{value:e.jenkinsInstanceId,callback:function(t){e.jenkinsInstanceId=t},expression:"jenkinsInstanceId"}},e._l(e.jenkinsInstanceOptions,(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1),n("el-button",{attrs:{size:"mini",type:"primary",disabled:""===e.jenkinsInstanceId},on:{click:e.handlerEngineAdd}},[e._v("添加 ")])],1),n("el-row",{directives:[{name:"show",rawName:"v-show",value:1===e.application.engineType,expression:"application.engineType === 1"}],staticStyle:{"margin-bottom":"5px","margin-left":"5px"},attrs:{gutter:24}},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.engineLoading,expression:"engineLoading"}],attrs:{data:e.engines}},[n("el-table-column",{attrs:{prop:"instance",label:"实例名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.row.instance.name))])]}}],null,!1,593344902)}),n("el-table-column",{attrs:{prop:"instance",label:"描述"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.row.instance.comment))])]}}],null,!1,2974055794)}),n("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"danger",plain:"",size:"mini"},on:{click:function(n){return e.handlerEngineRowRemove(t.row)}}},[e._v("移除")])]}}],null,!1,1805247854)})],1)],1)],1):e._e()],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{size:"mini"},on:{click:function(t){e.formStatus.visible=!1}}},[e._v("取消")]),n("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.handlerSave}},[e._v("确定")])],1)],1)},i=[],r=(n("b0c0"),n("e68b")),o=n("8b7e"),s=n("7d80"),l=n("65ce"),c=[{value:0,label:"所有引擎"},{value:1,label:"指定引擎"}],u=[{value:"LOCAL",label:"本地数据源"},{value:"OPSCLOUD",label:"OPSCLOUD"}],p={data:function(){return{activeName:"application",application:{},labelWidth:"150px",options:{stripe:!0},serverLoading:!1,serverOptions:[],scmMembers:[],scmMemberLoading:!1,gitlabInstanceOptions:[],queryGitlabParam:{instanceId:"",queryName:""},projectId:"",projectOptions:[],queryJenkinsParam:{queryName:""},sourceType:"OPSCLOUD",sourceTypeOptions:u,serverGroup:"",serverGroupOptions:[],applicationServerGroupLoading:!1,serverGroups:[],jenkinsInstanceId:"",engineLoading:!1,engines:[],engineTypeOptions:c,jenkinsInstanceOptions:[]}},name:"ApplicationDialog",props:["formStatus"],components:{},mounted:function(){},methods:{initData:function(e){this.application=e,""!==e.id&&(this.getScmMember(),this.getGitlabInstance(""),1===this.application.engineType&&this.getEngine(),null!==e.serverGroups&&e.serverGroups.length>0&&(this.serverGroups=e.serverGroups))},handleClick:function(){this.$emit("input",!this.value)},getServerGroup:function(e){var t=this,n={source:this.sourceType,name:e,grpType:"",page:1,length:10};Object(l["p"])(n).then((function(e){t.serverGroupOptions=e.body.data}))},getEngine:function(){var e=this;0===this.application.engineType?this.engines=[]:(this.engineLoading=!0,Object(l["i"])(this.application.id).then((function(t){t.success?e.engines=t.body:e.$message.error(t.msg),e.engineLoading=!1})))},getScmMember:function(){var e=this;this.scmMemberLoading=!0,Object(l["k"])(this.application.id).then((function(t){t.success?e.scmMembers=t.body:e.$message.error(t.msg),e.scmMemberLoading=!1}))},getApplicationServerGroup:function(){var e=this;this.applicationServerGroupLoading=!0,Object(l["n"])(this.application.id).then((function(t){t.success?e.serverGroups=t.body:e.$message.error(t.msg),e.applicationServerGroupLoading=!1}))},getJenkinsInstance:function(e){var t=this;this.loading=!0;var n={queryName:e,extend:1,page:1,length:10};Object(s["c"])(n).then((function(e){t.jenkinsInstanceOptions=e.body.data}))},getGitlabInstance:function(e){var t=this,n={queryName:e,extend:0,page:1,length:10};Object(r["c"])(n).then((function(e){t.gitlabInstanceOptions=e.body.data}))},handlerSelGitlabInstance:function(){this.getProject("")},getProject:function(e){var t=this,n={instanceId:this.queryGitlabParam.instanceId,queryName:e,extend:1,page:1,length:10};Object(o["b"])(n).then((function(e){t.projectOptions=e.body.data}))},handlerBuildKey:function(){this.application.applicationKey=this.application.name.toUpperCase()},handlerSelEngineType:function(){1===this.application.engineType&&this.getJenkinsInstance("")},handlerEngineAdd:function(){var e=this;Object(l["b"])(this.application.id,this.jenkinsInstanceId).then((function(t){t.success?(e.$message({message:"成功",type:"success"}),e.jenkinsInstanceId="",e.getEngine()):e.$message.error(t.msg)}))},handlerServerGroupAdd:function(){var e=this,t={id:"",applicationId:this.application.id,serverGroupName:this.serverGroup.name,serverGroupId:this.serverGroup.id,comment:this.serverGroup.comment,source:this.sourceType};Object(l["d"])(t).then((function(t){t.success?(e.$message({message:"成功",type:"success"}),e.serverGroup="",e.getApplicationServerGroup()):e.$message.error(t.msg)}))},handlerScmMemberAdd:function(){var e=this;Object(l["c"])(this.application.id,this.projectId).then((function(t){t.success?(e.$message({message:"成功",type:"success"}),e.projectId="",e.getScmMember()):e.$message.error(t.msg)}))},handlerEngineRowRemove:function(e){var t=this;Object(l["q"])(e.id).then((function(e){t.$message({message:"删除成功",type:"success"}),t.getEngine()}))},handlerScmMemberRowRemove:function(e){var t=this;Object(l["r"])(e.id).then((function(e){t.$message({message:"删除成功",type:"success"}),t.getScmMember()}))},handlerServerGroupRowRemove:function(e){var t=this;Object(l["s"])(e.id).then((function(e){t.$message({message:"删除成功",type:"success"}),t.getApplicationServerGroup()}))},handlerSave:function(){var e=this;setTimeout((function(){var t=Object.assign({},e.application);e.formStatus.operationType?Object(l["a"])(t).then((function(t){e.$message({message:"成功",type:"success"}),e.formStatus.visible=!1,e.$emit("closeDialog")})):Object(l["v"])(t).then((function(t){e.$message({message:"成功",type:"success"}),e.formStatus.visible=!1,e.$emit("closeDialog")}))}),600)}}},d=p,m=(n("c318"),n("2877")),f=function(e){e.options.__source="src/components/opscloud/application/ApplicationDialog.vue"},g=f,b=Object(m["a"])(d,a,i,!1,null,null,null);"function"===typeof g&&g(b);t["a"]=b.exports},c318:function(e,t,n){"use strict";var a=n("5672"),i=n.n(a);i.a},e68b:function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return o})),n.d(t,"d",(function(){return s})),n.d(t,"b",(function(){return l}));var a=n("9bd2"),i="/gitlab/instance";function r(e){return Object(a["a"])({url:i+"/page/query",method:"post",data:e})}function o(e){return Object(a["a"])({url:i+"/add",method:"post",data:e})}function s(e){return Object(a["a"])({url:i+"/update",method:"put",data:e})}function l(e){return Object(a["a"])({url:i+"/del?id="+e,method:"delete"})}},e886:function(e,t,n){},f3cb:function(e,t,n){"use strict";var a=n("e886"),i=n.n(a);i.a},f680:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("d2-container",[[n("div",[n("h1",[e._v(e._s(e.title))])]),n("el-row",{staticStyle:{"margin-bottom":"5px"},attrs:{gutter:24}},[n("el-input",{staticClass:"input",attrs:{placeholder:"输入关键字模糊查询"},model:{value:e.queryParam.queryName,callback:function(t){e.$set(e.queryParam,"queryName",t)},expression:"queryParam.queryName"}}),n("el-select",{staticClass:"select",attrs:{filterable:"",clearable:"",remote:"","reserve-keyword":"",placeholder:"请输入关键词搜索标签","remote-method":e.getTag,loading:e.loading},model:{value:e.queryParam.tagId,callback:function(t){e.$set(e.queryParam,"tagId",t)},expression:"queryParam.tagId"}},e._l(e.tagOptions,(function(e){return n("el-option",{key:e.id,attrs:{label:e.tagKey,value:e.id}})})),1),n("el-button",{staticStyle:{"margin-left":"5px"},on:{click:e.fetchData}},[e._v("查询")]),n("el-button",{staticStyle:{"margin-left":"5px"},on:{click:e.handlerAdd}},[e._v("新增")])],1),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData}},[n("el-table-column",{attrs:{prop:"name",label:"应用名称"}}),n("el-table-column",{attrs:{prop:"applicationKey",label:"key"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-tag",{attrs:{"disable-transitions":"",type:"primary",plain:"",size:"mini"}},[e._v(e._s(t.row.applicationKey))])]}}])}),n("el-table-column",{attrs:{prop:"comment",label:"描述"}}),n("el-table-column",{attrs:{prop:"tags",label:"标签",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",{staticClass:"tag-group"},e._l(t.row.tags,(function(t){return n("span",{key:t.id},[n("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:t.comment,placement:"top-start"}},[n("el-tag",{staticStyle:{"margin-left":"5px"},style:{color:t.color}},[e._v(e._s(t.tagKey))])],1)],1)})),0)]}}])}),n("el-table-column",{attrs:{fixed:"right",label:"操作",width:"280"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:function(n){return e.handlerRowPermissionEdit(t.row)}}},[e._v("权限")]),n("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:function(n){return e.handlerRowEdit(t.row)}}},[e._v("编辑")]),n("el-button",{attrs:{type:"danger",plain:"",size:"mini"},on:{click:function(n){return e.handlerRowDel(t.row)}}},[e._v("删除")])]}}])})],1),n("el-pagination",{attrs:{background:"","page-sizes":[10,15,20,25,30],layout:"sizes, prev, pager, next",total:e.pagination.total,"current-page":e.pagination.currentPage,"page-size":e.pagination.pageSize},on:{"current-change":e.paginationCurrentChange,"size-change":e.handleSizeChange}}),n("ApplicationDialog",{ref:"applicationDialog",attrs:{formStatus:e.formStatus},on:{closeDialog:e.fetchData}}),n("ApplicationPermissionDialog",{ref:"applicationPermissionDialog",attrs:{formStatus:e.formPermissionStatus},on:{closeDialog:e.fetchData}})]],2)},i=[],r=(n("a4d3"),n("4de4"),n("e439"),n("dbb4"),n("b64b"),n("159b"),n("ade3")),o=n("5880"),s=n("81ce"),l=n("b3eb"),c=n("a3e9"),u=n("65ce");function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){Object(r["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var m={name:"ApplicationTable",data:function(){return{title:"应用管理",tableData:[],options:{stripe:!0},loading:!1,pagination:{currentPage:1,pageSize:10,total:0},queryParam:{instanceId:"",queryName:"",tagId:""},tagOptions:[],formStatus:{visible:!1,operationType:!0,addTitle:"新增应用配置",updateTitle:"更新应用配置"},formPermissionStatus:{visible:!1}}},computed:d({},Object(o["mapState"])("d2admin/user",["info"])),mounted:function(){this.initPageSize(),this.getTag(""),this.fetchData()},components:{ApplicationDialog:l["a"],ApplicationPermissionDialog:s["a"]},methods:d({},Object(o["mapActions"])({setPageSize:"d2admin/user/set"}),{handleSizeChange:function(e){this.pagination.pageSize=e,this.info.pageSize=e,this.setPageSize(this.info),this.fetchData()},initPageSize:function(){"undefined"!==typeof this.info.pageSize&&(this.pagination.pageSize=this.info.pageSize)},getTag:function(e){var t=this;Object(c["d"])(e,1,100).then((function(e){t.tagOptions=e.body.data}))},handlerAdd:function(){this.formStatus.operationType=!0;var e={id:"",name:"",applicationKey:"",kubernetesApplicationId:"",enableGitflow:!1,engineType:0,comment:""};this.$refs.applicationDialog.initData(e),this.formStatus.visible=!0},handlerRowEdit:function(e){this.formStatus.operationType=!1,this.formStatus.visible=!0,this.$refs.applicationDialog.initData(Object.assign({},e))},handlerRowDel:function(e){var t=this;this.$confirm("此操作将删除当前配置?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(u["f"])(e.id).then((function(e){t.fetchData(),t.$message({type:"success",message:"删除成功!"})}))})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},handlerRowPermissionEdit:function(e){this.formPermissionStatus.visible=!0,this.$refs.applicationPermissionDialog.initData(Object.assign({},e))},paginationCurrentChange:function(e){this.pagination.currentPage=e,this.fetchData()},fetchData:function(){var e=this;this.loading=!0;var t={queryName:this.queryParam.queryName,tagId:this.queryParam.tagId,extend:1,page:this.pagination.currentPage,length:this.pagination.pageSize};Object(u["j"])(t).then((function(t){e.tableData=t.body.data,e.pagination.total=t.body.totalNum,e.loading=!1}))}})},f=m,g=(n("f3cb"),n("2877")),b=function(e){e.options.__source="src/pages/application/index.vue"},h=b,v=Object(g["a"])(f,a,i,!1,null,null,null);"function"===typeof h&&h(v);t["default"]=v.exports}}]);