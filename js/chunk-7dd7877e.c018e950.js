(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7dd7877e"],{"0462":function(e,t,r){"use strict";var n=r("634f"),s=r.n(n);s.a},"2d8e":function(e,t,r){"use strict";r.d(t,"h",(function(){return s})),r.d(t,"g",(function(){return a})),r.d(t,"e",(function(){return i})),r.d(t,"b",(function(){return o})),r.d(t,"m",(function(){return c})),r.d(t,"j",(function(){return l})),r.d(t,"d",(function(){return u})),r.d(t,"f",(function(){return d})),r.d(t,"l",(function(){return h})),r.d(t,"a",(function(){return p})),r.d(t,"c",(function(){return m})),r.d(t,"k",(function(){return g})),r.d(t,"i",(function(){return f}));var n=r("9bd2");function s(e,t,r,s){return Object(n["a"])({url:"/user/page/query?username="+e+"&extend="+t+"&page="+r+"&length="+s,method:"get"})}function a(){return Object(n["a"])({url:"/user/detail",method:"get"})}function i(e){return Object(n["a"])({url:"/user/page/fuzzy/query",method:"post",data:e})}function o(e){return Object(n["a"])({url:"/user/create",method:"post",data:e})}function c(e){return Object(n["a"])({url:"/user/update",method:"put",data:e})}function l(e){return Object(n["a"])({url:"/user/retire?id="+e,method:"put"})}function u(e){return Object(n["a"])({url:"/user/del?id="+e,method:"delete"})}function d(){return Object(n["a"])({url:"/user/password/random",method:"get"})}function h(){return Object(n["a"])({url:"/user/ldap/sync",method:"get"})}function p(e){return Object(n["a"])({url:"/user/token/apply",method:"post",data:e})}function m(e){return Object(n["a"])({url:"/user/token/del?id="+e,method:"delete"})}function g(e){return Object(n["a"])({url:"/user/credential/save",method:"post",data:e})}function f(e){return Object(n["a"])({url:"/user/server/tree/query",method:"post",data:e})}},"446e":function(e,t){ace.define("ace/mode/sh_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules"],(function(e,t,r){"use strict";var n=e("../lib/oop"),s=e("./text_highlight_rules").TextHighlightRules,a=t.reservedKeywords="!|{|}|case|do|done|elif|else|esac|fi|for|if|in|then|until|while|&|;|export|local|read|typeset|unset|elif|select|set|function|declare|readonly",i=t.languageConstructs="[|]|alias|bg|bind|break|builtin|cd|command|compgen|complete|continue|dirs|disown|echo|enable|eval|exec|exit|fc|fg|getopts|hash|help|history|jobs|kill|let|logout|popd|printf|pushd|pwd|return|set|shift|shopt|source|suspend|test|times|trap|type|ulimit|umask|unalias|wait",o=function(){var e=this.createKeywordMapper({keyword:a,"support.function.builtin":i,"invalid.deprecated":"debugger"},"identifier"),t="(?:(?:[1-9]\\d*)|(?:0))",r="(?:\\.\\d+)",n="(?:\\d+)",s="(?:(?:"+n+"?"+r+")|(?:"+n+"\\.))",o="(?:(?:"+s+"|"+n+"))",c="(?:"+o+"|"+s+")",l="(?:&"+n+")",u="[a-zA-Z_][a-zA-Z0-9_]*",d="(?:"+u+"(?==))",h="(?:\\$(?:SHLVL|\\$|\\!|\\?))",p="(?:"+u+"\\s*\\(\\))";this.$rules={start:[{token:"constant",regex:/\\./},{token:["text","comment"],regex:/(^|\s)(#.*)$/},{token:"string.start",regex:'"',push:[{token:"constant.language.escape",regex:/\\(?:[$`"\\]|$)/},{include:"variables"},{token:"keyword.operator",regex:/`/},{token:"string.end",regex:'"',next:"pop"},{defaultToken:"string"}]},{token:"string",regex:"\\$'",push:[{token:"constant.language.escape",regex:/\\(?:[abeEfnrtv\\'"]|x[a-fA-F\d]{1,2}|u[a-fA-F\d]{4}([a-fA-F\d]{4})?|c.|\d{1,3})/},{token:"string",regex:"'",next:"pop"},{defaultToken:"string"}]},{regex:"<<<",token:"keyword.operator"},{stateName:"heredoc",regex:"(<<-?)(\\s*)(['\"`]?)([\\w\\-]+)(['\"`]?)",onMatch:function(e,t,r){var n="-"==e[2]?"indentedHeredoc":"heredoc",s=e.split(this.splitRegex);return r.push(n,s[4]),[{type:"constant",value:s[1]},{type:"text",value:s[2]},{type:"string",value:s[3]},{type:"support.class",value:s[4]},{type:"string",value:s[5]}]},rules:{heredoc:[{onMatch:function(e,t,r){return e===r[1]?(r.shift(),r.shift(),this.next=r[0]||"start","support.class"):(this.next="","string")},regex:".*$",next:"start"}],indentedHeredoc:[{token:"string",regex:"^\t+"},{onMatch:function(e,t,r){return e===r[1]?(r.shift(),r.shift(),this.next=r[0]||"start","support.class"):(this.next="","string")},regex:".*$",next:"start"}]}},{regex:"$",token:"empty",next:function(e,t){return"heredoc"===t[0]||"indentedHeredoc"===t[0]?t[0]:e}},{token:["keyword","text","text","text","variable"],regex:/(declare|local|readonly)(\s+)(?:(-[fixar]+)(\s+))?([a-zA-Z_][a-zA-Z0-9_]*\b)/},{token:"variable.language",regex:h},{token:"variable",regex:d},{include:"variables"},{token:"support.function",regex:p},{token:"support.function",regex:l},{token:"string",start:"'",end:"'"},{token:"constant.numeric",regex:c},{token:"constant.numeric",regex:t+"\\b"},{token:e,regex:"[a-zA-Z_][a-zA-Z0-9_]*\\b"},{token:"keyword.operator",regex:"\\+|\\-|\\*|\\*\\*|\\/|\\/\\/|~|<|>|<=|=>|=|!=|[%&|`]"},{token:"punctuation.operator",regex:";"},{token:"paren.lparen",regex:"[\\[\\(\\{]"},{token:"paren.rparen",regex:"[\\]]"},{token:"paren.rparen",regex:"[\\)\\}]",next:"pop"}],variables:[{token:"variable",regex:/(\$)(\w+)/},{token:["variable","paren.lparen"],regex:/(\$)(\()/,push:"start"},{token:["variable","paren.lparen","keyword.operator","variable","keyword.operator"],regex:/(\$)(\{)([#!]?)(\w+|[*@#?\-$!0_])(:[?+\-=]?|##?|%%?|,,?\/|\^\^?)?/,push:"start"},{token:"variable",regex:/\$[*@#?\-$!0_]/},{token:["variable","paren.lparen"],regex:/(\$)(\{)/,push:"start"}]},this.normalizeRules()};n.inherits(o,s),t.ShHighlightRules=o})),ace.define("ace/mode/folding/cstyle",["require","exports","module","ace/lib/oop","ace/range","ace/mode/folding/fold_mode"],(function(e,t,r){"use strict";var n=e("../../lib/oop"),s=e("../../range").Range,a=e("./fold_mode").FoldMode,i=t.FoldMode=function(e){e&&(this.foldingStartMarker=new RegExp(this.foldingStartMarker.source.replace(/\|[^|]*?$/,"|"+e.start)),this.foldingStopMarker=new RegExp(this.foldingStopMarker.source.replace(/\|[^|]*?$/,"|"+e.end)))};n.inherits(i,a),function(){this.foldingStartMarker=/([\{\[\(])[^\}\]\)]*$|^\s*(\/\*)/,this.foldingStopMarker=/^[^\[\{\(]*([\}\]\)])|^[\s\*]*(\*\/)/,this.singleLineBlockCommentRe=/^\s*(\/\*).*\*\/\s*$/,this.tripleStarBlockCommentRe=/^\s*(\/\*\*\*).*\*\/\s*$/,this.startRegionRe=/^\s*(\/\*|\/\/)#?region\b/,this._getFoldWidgetBase=this.getFoldWidget,this.getFoldWidget=function(e,t,r){var n=e.getLine(r);if(this.singleLineBlockCommentRe.test(n)&&!this.startRegionRe.test(n)&&!this.tripleStarBlockCommentRe.test(n))return"";var s=this._getFoldWidgetBase(e,t,r);return!s&&this.startRegionRe.test(n)?"start":s},this.getFoldWidgetRange=function(e,t,r,n){var s=e.getLine(r);if(this.startRegionRe.test(s))return this.getCommentRegionBlock(e,s,r);var a=s.match(this.foldingStartMarker);if(a){var i=a.index;if(a[1])return this.openingBracketBlock(e,a[1],r,i);var o=e.getCommentFoldRange(r,i+a[0].length,1);return o&&!o.isMultiLine()&&(n?o=this.getSectionRange(e,r):"all"!=t&&(o=null)),o}if("markbegin"!==t){a=s.match(this.foldingStopMarker);if(a){i=a.index+a[0].length;return a[1]?this.closingBracketBlock(e,a[1],r,i):e.getCommentFoldRange(r,i,-1)}}},this.getSectionRange=function(e,t){var r=e.getLine(t),n=r.search(/\S/),a=t,i=r.length;t+=1;var o=t,c=e.getLength();while(++t<c){r=e.getLine(t);var l=r.search(/\S/);if(-1!==l){if(n>l)break;var u=this.getFoldWidgetRange(e,"all",t);if(u){if(u.start.row<=a)break;if(u.isMultiLine())t=u.end.row;else if(n==l)break}o=t}}return new s(a,i,o,e.getLine(o).length)},this.getCommentRegionBlock=function(e,t,r){var n=t.search(/\s*$/),a=e.getLength(),i=r,o=/^\s*(?:\/\*|\/\/|--)#?(end)?region\b/,c=1;while(++r<a){t=e.getLine(r);var l=o.exec(t);if(l&&(l[1]?c--:c++,!c))break}var u=r;if(u>i)return new s(i,n,u,t.length)}}.call(i.prototype)})),ace.define("ace/mode/sh",["require","exports","module","ace/lib/oop","ace/mode/text","ace/mode/sh_highlight_rules","ace/range","ace/mode/folding/cstyle","ace/mode/behaviour/cstyle"],(function(e,t,r){"use strict";var n=e("../lib/oop"),s=e("./text").Mode,a=e("./sh_highlight_rules").ShHighlightRules,i=e("../range").Range,o=e("./folding/cstyle").FoldMode,c=e("./behaviour/cstyle").CstyleBehaviour,l=function(){this.HighlightRules=a,this.foldingRules=new o,this.$behaviour=new c};n.inherits(l,s),function(){this.lineCommentStart="#",this.getNextLineIndent=function(e,t,r){var n=this.$getIndent(t),s=this.getTokenizer().getLineTokens(t,e),a=s.tokens;if(a.length&&"comment"==a[a.length-1].type)return n;if("start"==e){var i=t.match(/^.*[\{\(\[:]\s*$/);i&&(n+=r)}return n};var e={pass:1,return:1,raise:1,break:1,continue:1};this.checkOutdent=function(t,r,n){if("\r\n"!==n&&"\r"!==n&&"\n"!==n)return!1;var s=this.getTokenizer().getLineTokens(r.trim(),t).tokens;if(!s)return!1;do{var a=s.pop()}while(a&&("comment"==a.type||"text"==a.type&&a.value.match(/^\s+$/)));return!!a&&("keyword"==a.type&&e[a.value])},this.autoOutdent=function(e,t,r){r+=1;var n=this.$getIndent(t.getLine(r)),s=t.getTabString();n.slice(-s.length)==s&&t.remove(new i(r,n.length-s.length,r,n.length))},this.$id="ace/mode/sh"}.call(l.prototype),t.Mode=l}))},"634f":function(e,t,r){},"67ee":function(e,t,r){"use strict";r.d(t,"h",(function(){return s})),r.d(t,"i",(function(){return a})),r.d(t,"j",(function(){return i})),r.d(t,"o",(function(){return o})),r.d(t,"e",(function(){return c})),r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return u})),r.d(t,"m",(function(){return d})),r.d(t,"c",(function(){return h})),r.d(t,"q",(function(){return p})),r.d(t,"f",(function(){return m})),r.d(t,"n",(function(){return g})),r.d(t,"d",(function(){return f})),r.d(t,"r",(function(){return v})),r.d(t,"g",(function(){return k})),r.d(t,"l",(function(){return b})),r.d(t,"k",(function(){return y})),r.d(t,"p",(function(){return x}));var n=r("9bd2");function s(e){return Object(n["a"])({url:"/server/task/command/executor",method:"post",data:e})}function a(e){return Object(n["a"])({url:"/server/task/playbook/executor",method:"post",data:e})}function i(e){return Object(n["a"])({url:"/server/task/script/executor",method:"post",data:e})}function o(e){return Object(n["a"])({url:"/server/task/query?taskId="+e,method:"get"})}function c(){return Object(n["a"])({url:"/server/task/ansible/hosts/create",method:"get"})}function l(e){return Object(n["a"])({url:"/server/task/abort?taskId="+e,method:"get"})}function u(e){return Object(n["a"])({url:"/server/task/member/abort?memberId="+e,method:"get"})}function d(e){return Object(n["a"])({url:"/server/task/playbook/page/query",method:"post",data:e})}function h(e){return Object(n["a"])({url:"/server/task/playbook/add",method:"post",data:e})}function p(e){return Object(n["a"])({url:"/server/task/playbook/update",method:"put",data:e})}function m(e){return Object(n["a"])({url:"/server/task/playbook/del?id="+e,method:"delete"})}function g(e){return Object(n["a"])({url:"/server/task/script/page/query",method:"post",data:e})}function f(e){return Object(n["a"])({url:"/server/task/script/add",method:"post",data:e})}function v(e){return Object(n["a"])({url:"/server/task/script/update",method:"put",data:e})}function k(e){return Object(n["a"])({url:"/server/task/script/del?id="+e,method:"delete"})}function b(){return Object(n["a"])({url:"/server/task/ansible/version",method:"get"})}function y(){return Object(n["a"])({url:"/server/task/ansible/hosts/preview",method:"get"})}function x(e){return Object(n["a"])({url:"/server/task/history/page/query",method:"post",data:e})}},"95ff":function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{attrs:{title:e.title,visible:e.formStatus.visible,width:"80%","before-close":e.handlerCloseDialog},on:{"update:visible":function(t){return e.$set(e.formStatus,"visible",t)}}},[e._l(e.xterms,(function(t){return r("div",{key:t},[[r("el-col",{attrs:{span:24}},[r("el-card",{staticStyle:{"margin-right":"10px","margin-bottom":"10px"},attrs:{shadow:"hover","body-style":"padding: 2px"}},[r("div",{staticClass:"clearfix",staticStyle:{height:"15px"},attrs:{slot:"header"},slot:"header"},[r("span",[r("el-tag",[e._v(" "+e._s(t))])],1),r("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"退出",placement:"top-start"}},[r("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:function(r){return e.handlerLogout(t)}}},[e._v(" Logout ")])],1),r("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"复制会话",placement:"top-start"}},[r("el-button",{staticStyle:{float:"right",padding:"3px 0","margin-right":"20px"},attrs:{type:"text"},on:{click:function(t){return e.handlerDuplicateSession()}}},[e._v("Duplicate ")])],1)],1),r("div",{staticClass:"xterm",attrs:{id:t}})])],1)]],2)})),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"mini"},on:{click:e.handlerExit}},[e._v("关闭")])],1)],2)},s=[],a=(r("4de4"),r("d81d"),r("b0c0"),r("1276"),r("c276")),i=(r("abb2"),r("fcf3")),o=r("47d0"),c=r("e232"),l="ws/xterm",u="XTERM",d={data:function(){return{title:"Web-XTerminal",socketURI:a["a"].wsUrl(l),server:{},addonMap:[],xterms:[],xtermMap:{},timer:null,xtermSize:{rows:30},xtermTheme:{foreground:"#FFFFFF",background:"#606266",cursor:"help"}}},name:"XTerm",props:["formStatus"],mixins:[],mounted:function(){this.setXTermSetting()},beforeDestroy:function(){try{for(var e in this.socket.close(),this.xtermMap)this.xtermMap[e].dispose()}catch(t){}clearInterval(this.timer)},methods:{setXTermSetting:function(){var e=this;Object(c["a"])(u).then((function(t){if(t.success)try{e.xtermTheme.foreground=t.body["XTERM_FOREGROUND"],e.xtermTheme.background=t.body["XTERM_BACKGROUND"],e.xtermSize.rows=t.body["XTERM_ROWS"]||30}catch(r){}else e.$message.error(t.msg)}))},handlerExit:function(){this.handlerClose();try{for(var e in this.socket.close(),this.xtermMap)this.xtermMap[e].dispose()}catch(t){}this.formStatus.visible=!1},initData:function(e){this.server=e,this.handlerLogin()},setTimer:function(){var e=this;this.timer=setInterval((function(){e.handlerSSHHeartbeat()}),1e4)},handlerSSHHeartbeat:function(){var e={status:"HEARTBEAT"};try{this.socketOnSend(JSON.stringify(e))}catch(t){}},initTermInstance:function(e){var t=this,r=e.name,n=new i["Terminal"]({rendererType:"canvas",allowTransparency:!0,fontSize:11,rows:this.xtermSize.rows,theme:this.xtermTheme,termName:"xterm",visualBell:!1,popOnBell:!1,scrollback:1e3,screenKeys:!1,debug:!1,cancelEvents:!1,cursorStyle:"underline",cursorBlink:!0,convertEol:!0});t.addonMap[r]=new o["FitAddon"],n.loadAddon(t.addonMap[r]),n.open(document.getElementById(r)),t.addonMap[r].fit(),n.focus(),n.onData((function(e){var n={data:e,status:"COMMAND",instanceId:r};t.socketOnSend(JSON.stringify(n))})),this.xtermMap[r]=n},handlerResize:function(){for(var e in this.xtermMap){this.addonMap[e].fit();var t={status:"RESIZE",instanceId:e,xtermWidth:7*this.addonMap[e]._terminal.cols,xtermHeight:document.getElementById(e).clientHeight};this.socketOnSend(JSON.stringify(t)),this.xtermMap[e].scrollToBottom()}},handlerDuplicateSession:function(){var e=this,t=this.server.name+"#"+a["a"].uuid(),r={status:"DUPLICATE_SESSION_IP",duplicateInstanceId:this.server.name,token:a["a"].cookies.get("token"),instanceId:t,xtermWidth:7*this.addonMap[t.split("#")[0]]._terminal.cols,xtermHeight:document.getElementById(t.split("#")[0]).clientHeight};this.xterms.push(t);var n={name:t,ip:this.server.privateIp};this.$nextTick((function(){e.initTermInstance(n),e.socketOnSend(JSON.stringify(r))}))},handlerLogout:function(e){var t={status:"LOGOUT",instanceId:e};this.socketOnSend(JSON.stringify(t));var r=this.xtermMap[e];r.dispose(),delete this.xtermMap[e],this.xterms=this.xterms.filter((function(t){return t!==e})),this.$message.warning(e+"终端已关闭")},handlerClose:function(){var e={status:"CLOSE"};this.socketOnSend(JSON.stringify(e)),this.xterms=[],this.xtermMap={},clearInterval(this.timer)},handlerCloseDialog:function(e){var t=this;this.$confirm("确定退出Web终端,并关闭所有会话?").then((function(r){e(),t.handlerExit()})).catch((function(e){}))},handlerLogin:function(){this.xtermMap={},this.initSocket(),this.setTimer()},initSocket:function(){this.socket=new WebSocket(this.socketURI),this.socketOnClose(),this.socketOnOpen(),this.socketOnError(),this.socketOnMessage()},socketOnOpen:function(){var e=this;this.socket.onopen=function(){try{e.xterms=[],e.xterms.push(e.server.name),e.$nextTick((function(){e.initTermInstance(e.server);var t={token:a["a"].cookies.get("token"),instanceId:e.server.name,ip:e.server.privateIp,status:"INITIAL_IP",xtermWidth:0,xtermHeight:308};e.socketOnSend(JSON.stringify(t)),e.$nextTick((function(){e.handlerResize()}))}))}catch(t){e.$message.error("登录失败，未选择服务器或其它原因")}}},socketOnClose:function(){this.socket.onclose=function(){}},socketOnError:function(){this.socket.onerror=function(){}},socketOnSend:function(e){this.socket.send(e)},socketOnMessage:function(){var e=this;this.socket.onmessage=function(t){var r=JSON.parse(t.data),n=e;r.map((function(e){n.xtermMap[e.instanceId].write(e.output)}))}}}},h=d,p=(r("0462"),r("2877")),m=function(e){e.options.__source="src/components/opscloud/xterm/XTerm.vue"},g=m,f=Object(p["a"])(h,n,s,!1,null,null,null);"function"===typeof g&&g(f);t["a"]=f.exports},b06d:function(e,t,r){"use strict";r.d(t,"c",(function(){return s})),r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return i})),r.d(t,"d",(function(){return o}));var n=r("9bd2");function s(e,t,r,s){return Object(n["a"])({url:"/server/group/type/page/query?name="+e+"&grpType="+t+"&page="+r+"&length="+s,method:"get"})}function a(e){return Object(n["a"])({url:"/server/group/type/add",method:"post",data:e})}function i(e){return Object(n["a"])({url:"/server/group/type/del?id="+e,method:"delete"})}function o(e){return Object(n["a"])({url:"/server/group/type/update",method:"put",data:e})}},b3df:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("d2-container",[[r("div",[r("h1",[e._v("批量命令")])]),r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:8}},[r("ServerTree",{ref:"serverTree"})],1),r("el-col",{attrs:{span:16}},[r("el-tooltip",{attrs:{content:"系统命令输入框",placement:"bottom",effect:"light"}},[r("editor",{attrs:{lang:"sh",theme:"chrome",width:"800",height:"80",options:e.options},on:{init:e.editorInit},model:{value:e.executorCommandParam.command,callback:function(t){e.$set(e.executorCommandParam,"command",t)},expression:"executorCommandParam.command"}})],1),r("el-row",{staticStyle:{"margin-top":"5px"},attrs:{gutter:10}},[r("el-col",{attrs:{span:6}},[r("el-tooltip",{attrs:{content:"并发线程数",placement:"bottom",effect:"light"}},[r("el-slider",{attrs:{min:2,max:10,step:2,"show-stops":""},model:{value:e.executorCommandParam.concurrent,callback:function(t){e.$set(e.executorCommandParam,"concurrent",t)},expression:"executorCommandParam.concurrent"}})],1)],1),r("el-col",{attrs:{span:2}},[r("el-tooltip",{attrs:{content:"批量命令执行",placement:"bottom",effect:"light"}},[r("el-button",{style:e.searchBarStyle,on:{click:e.executorCommand}},[e._v("执行")])],1)],1)],1),r("AnsibleResult",{ref:"ansibleResult"})],1)],1)]],2)},s=[],a=r("c8c3"),i=r("ebec"),o=r("67ee"),c={data:function(){return{taskId:"",searchBarHeadStyle:{display:"inline-block",maxWidth:"200px"},searchBarStyle:{marginLeft:"5px"},serverGroup:{},uuid:"",options:{stripe:!0},executorCommandParam:{command:"",concurrent:4,becomeUser:"",hostPatterns:[],uuid:"",taskType:0}}},mounted:function(){},components:{ServerTree:a["a"],AnsibleResult:i["a"],editor:r("7c9e")},methods:{editorInit:function(){r("2099"),r("446e"),r("95b8"),r("ec5e")},executorCommand:function(){var e=this;try{var t=Object.assign({},this.executorCommandParam);t.uuid=this.$refs.serverTree.getUuid(),t.hostPatterns=this.$refs.serverTree.getCheckedKeys(!0),console.log(JSON.stringify(t)),Object(o["h"])(t).then((function(t){t.success?(e.$message({message:"任务执行中!",type:"success"}),e.$refs.ansibleResult.initData(t.body.id)):e.$message.error(t.msg)}))}catch(r){console.log(r)}}}},l=c,u=r("2877"),d=function(e){e.options.__source="src/pages/task/command/index.vue"},h=d,p=Object(u["a"])(l,n,s,!1,null,null,null);"function"===typeof h&&h(p);t["default"]=p.exports},c8c3:function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-row",{staticStyle:{"margin-bottom":"5px","margin-left":"2px"}},[r("el-input",{style:e.searchBarHeadStyle,attrs:{placeholder:"名称"},model:{value:e.queryParam.name,callback:function(t){e.$set(e.queryParam,"name",t)},expression:"queryParam.name"}}),r("el-select",{style:e.searchBarStyle,attrs:{filterable:"",clearable:"",remote:"","reserve-keyword":"",placeholder:"输入关键词搜组类型","remote-method":e.getGrpType,loading:e.loading},model:{value:e.queryParam.grpType,callback:function(t){e.$set(e.queryParam,"grpType",t)},expression:"queryParam.grpType"}},e._l(e.grpTypeOptions,(function(e){return r("el-option",{key:e.grpType,attrs:{label:e.name,value:e.grpType}})})),1),r("el-button",{style:e.searchBarStyle,attrs:{loading:e.searching},on:{click:e.fetchData}},[e._v("查询")]),e._e(),r("el-card",{staticClass:"box-card",staticStyle:{"margin-top":"5px"},attrs:{shadow:"never"}},[r("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[r("span",[r("i",{staticClass:"fa fa-list",attrs:{"aria-hidden":"true"}})]),r("el-tag",{staticStyle:{float:"right"},attrs:{"disable-transitions":""}},[e._v("Size: "+e._s(e.serverSize))])],1),r("el-tree",{ref:"myServerTree",attrs:{data:e.serverTree.tree,"show-checkbox":"","node-key":"id"}})],1)],1)},s=[],a=(r("b0c0"),r("b06d")),i=r("2d8e"),o=r("67ee"),c={data:function(){return{serverSize:0,loading:!1,grpTypeOptions:[],searching:!1,creating:!1,searchBarHeadStyle:{display:"inline-block",maxWidth:"200px"},searchBarStyle:{marginLeft:"5px"},queryParam:{name:"",grpType:""},serverTree:{}}},name:"ServerTree",props:[],mixins:[],mounted:function(){this.getGrpType("")},methods:{getGrpType:function(e){var t=this;Object(a["c"])(e,"",1,10).then((function(e){t.grpTypeOptions=e.body.data}))},createAnsibleHostsCfg:function(){var e=this;this.creating=!0,Object(o["e"])().then((function(t){t.success?e.$message({message:"ansible主机配置文件创建成功!",type:"success"}):e.$message.error(t.msg),e.creating=!1}))},getCheckedKeys:function(e){return this.$refs.myServerTree.getCheckedKeys(e)},getUuid:function(){return this.serverTree.uuid},fetchData:function(){var e=this;this.searching=!0,this.uuid="";var t={queryName:this.queryParam.name,grpType:this.queryParam.grpType};Object(i["i"])(t).then((function(t){e.serverTree=t.body,e.serverSize=t.body.size||0,e.uuid=t.body.uuid,e.searching=!1}))}}},l=c,u=r("2877"),d=function(e){e.options.__source="src/components/opscloud/tree/ServerTree.vue"},h=d,p=Object(u["a"])(l,n,s,!1,null,null,null);"function"===typeof h&&h(p);t["a"]=p.exports},ebec:function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[""!=e.serverTask&&null!=e.serverTask.memberMap?r("el-tabs",{attrs:{"tab-position":"top"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[null!=e.serverTask.memberMap.EXECUTE_QUEUE?r("el-tab-pane",{attrs:{name:"execute"}},[r("span",{attrs:{slot:"label"},slot:"label"},[r("i",{staticClass:"el-icon-loading"}),e._v(" 执行中")]),e._l(e.serverTask.memberMap.EXECUTE_QUEUE,(function(t){return r("el-card",{key:t.id,staticStyle:{"margin-top":"5px"},attrs:{shadow:"never"}},[r("el-row",[r("el-tag",{attrs:{"disable-transitions":""}},[e._v(e._s(t.hostPattern)+" - "+e._s(t.manageIp))]),r("el-tag",{style:{color:t.env.color,marginLeft:"5px"},attrs:{"disable-transitions":""}},[e._v(" "+e._s(t.env.envName)+" ")]),r("el-button",{staticStyle:{float:"right"},attrs:{type:"text"},on:{click:function(r){return e.abortServerTaskMember(t.id)}}},[e._v("停止")])],1),null!=t.outputMsgLog?r("d2-highlight",{staticStyle:{"margin-top":"5px"},attrs:{code:t.outputMsgLog}}):e._e()],1)}))],2):e._e(),null!=e.serverTask.memberMap.QUEUE?r("el-tab-pane",{attrs:{name:"queue"}},[r("span",{attrs:{slot:"label"},slot:"label"},[r("i",{staticClass:"el-icon-video-pause"}),e._v(" 队列")]),e._l(e.serverTask.memberMap.QUEUE,(function(t){return r("el-card",{key:t.id,staticStyle:{"margin-top":"5px"},attrs:{shadow:"never"}},[r("el-tag",{attrs:{"disable-transitions":""}},[e._v(e._s(t.hostPattern)+" - "+e._s(t.manageIp))]),r("el-tag",{style:{color:t.env.color,marginLeft:"5px"},attrs:{"disable-transitions":""}},[e._v(" "+e._s(t.env.envName)+" ")])],1)}))],2):e._e(),r("el-tab-pane",{attrs:{name:"finalized"}},[r("span",{attrs:{slot:"label"},slot:"label"},[r("i",{staticClass:"el-icon-check"}),e._v(" 完成")]),1===e.serverTask.finalized?r("div",[r("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.serverTask.taskStatistics.total))]),e._v(" 显示所有 ")],1),r("div",{staticStyle:{margin:"15px 0"}}),r("el-checkbox-group",{on:{change:e.handleCheckedResultsChange},model:{value:e.checkedResults,callback:function(t){e.checkedResults=t},expression:"checkedResults"}},e._l(e.resultOptions,(function(t){return r("el-checkbox",{key:t.key,attrs:{label:t.key}},[r("el-tag",{attrs:{size:"mini",type:t.type}},[e._v(e._s(t.count))]),e._v(" "+e._s(t.key)+" ")],1)})),1)],1):e._e(),e._l(e.serverTask.memberMap.FINALIZED,(function(t){return r("el-card",{directives:[{name:"show",rawName:"v-show",value:!t.hide,expression:"!member.hide"}],key:t.id,staticStyle:{"margin-top":"5px"},attrs:{shadow:"never"}},[r("el-row",[t.success?r("el-tag",{attrs:{"disable-transitions":"",color:"#5C887A"}},[r("span",{style:{color:"white"}},[e._v("success")])]):e._e(),t.success?e._e():r("el-tag",{attrs:{"disable-transitions":"",color:"#F56C6C"}},[r("span",{style:{color:"white"}},[e._v(e._s(t.taskResult))])]),r("el-tag",{style:{marginLeft:"5px"},attrs:{"disable-transitions":""}},[e._v(e._s(t.hostPattern)+" - "+e._s(t.manageIp)+" ")]),r("el-tag",{style:{color:t.env.color,marginLeft:"5px"},attrs:{"disable-transitions":""}},[e._v(" "+e._s(t.env.envName)+" ")]),r("el-button",{staticStyle:{float:"right","margin-right":"20px"},attrs:{type:"primary",plain:"",size:"mini"},on:{click:function(r){return e.handlerXTerm(t)}}},[e._v("登录 ")])],1),null==t.result&&null!=t.outputMsgLog?r("d2-highlight",{staticStyle:{"margin-top":"5px"},attrs:{code:t.outputMsgLog}}):e._e(),null!=t.result?r("d2-highlight",{staticStyle:{"margin-top":"5px"},attrs:{code:t.result.stdout}}):e._e(),t.showErrorLog?r("d2-highlight",{staticStyle:{"margin-top":"5px"},attrs:{code:t.errorMsgLog}}):e._e()],1)}))],2)],1):e._e(),r("XTerm",{ref:"xtermDialog",attrs:{formStatus:e.formXtermStatus}})],1)},s=[],a=r("95ff"),i=r("67ee"),o={data:function(){return{formXtermStatus:{visible:!1},serverTask:"",resultOptions:[],isIndeterminate:!0,checkAll:!0,checkedResults:[],timer:null,taskId:"",activeName:"",options:{stripe:!0},playbook:{},playbookOptions:[],labelWidth:"100px"}},name:"AnsibleResult",props:[],mixins:[],mounted:function(){},components:{XTerm:a["a"]},methods:{initData:function(e){this.timer=null,this.activeName="execute",this.taskId=e,this.queryTask(),this.setTimer()},handlerXTerm:function(e){this.formXtermStatus.visible=!0;var t={name:e.hostPattern,privateIp:e.manageIp};this.$refs.xtermDialog.initData(t)},handleCheckAllChange:function(e){this.checkedResults=e?["successful","failed","error"]:[],this.isIndeterminate=!1,this.setServerTaskMemberHide()},handleCheckedResultsChange:function(e){var t=e.length;this.checkAll=t===this.checkedResults.length,this.isIndeterminate=t>0&&t<this.checkedResults.length,this.setServerTaskMemberHide()},setServerTaskMemberHide:function(){for(var e=0;e<this.serverTask.memberMap.FINALIZED.length;e++){for(var t=this.serverTask.memberMap.FINALIZED[e],r=!0,n=0;n<this.checkedResults.length;n++)if(t.taskResult.toLowerCase()===this.checkedResults[n]){r=!1;break}t.hide=r}},setTimer:function(){var e=this;null==this.timer&&(this.timer=setInterval((function(){e.queryTask(),console.log("开始定时...每n秒执行一次")}),3e3))},handleDialogCancel:function(e){this.$message({message:"取消保存",type:"warning"}),e()},abortServerTask:function(e){var t=this;Object(i["a"])(e).then((function(e){e.success?t.$message({message:"任务停止中!",type:"success"}):t.$message.error(e.msg)}))},abortServerTaskMember:function(e){var t=this;Object(i["b"])(e).then((function(e){e.success?t.$message({message:"任务停止中!",type:"success"}):t.$message.error(e.msg)}))},queryTask:function(){var e=this;Object(i["o"])(this.taskId).then((function(t){if(e.serverTask=t.body,1===t.body.finalized){clearInterval(e.timer),e.resultOptions=[];var r={key:"successful",count:e.serverTask.taskStatistics.successfulCount,type:"success"};e.resultOptions.push(r);var n={key:"failed",count:e.serverTask.taskStatistics.failedCount,type:"warning"};e.resultOptions.push(n);var s={key:"error",count:e.serverTask.taskStatistics.errorCount,type:"danger"};e.resultOptions.push(s),e.checkedResults=["successful","failed","error"],e.activeName="finalized"}}))}}},c=o,l=r("2877"),u=function(e){e.options.__source="src/components/opscloud/ansible/AnsibleResult.vue"},d=u,h=Object(l["a"])(c,n,s,!1,null,"aacf9960",null);"function"===typeof d&&d(h);t["a"]=h.exports},ec5e:function(e,t){ace.define("ace/snippets/yaml",["require","exports","module"],(function(e,t,r){"use strict";t.snippetText=void 0,t.scope="yaml"}))}}]);