(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2f44c630"],{"0023":function(e,t,n){},"0462":function(e,t,n){"use strict";var s=n("634f"),a=n.n(s);a.a},"11a2":function(e,t,n){"use strict";function s(e){switch(e){case!0:return"success";case!1:return"warning";case 1:return"success";case 0:return"warning";default:return"info"}}function a(e){switch(e){case!0:return"有效";case!1:return"无效";case 1:return"有效";case 0:return"无效";default:return"未定义"}}n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return a}))},"14a3":function(e,t){e.exports="##### Jumpserver安装说明\n+ 建议使用全新安装的`jumpserver1.5.6`版本\n+ 安装文档参考官方说明https://jumpserver.readthedocs.io/zh/master/step_by_step.html\n+ 经本人测试jumpserver不支持Mysql8.0, 建议用Mysql5.6/5.7\n\n##### Jumpserver配置说明\n+ `资产管理` - `管理用户` 中配置管理用户（root）\n+ `资产管理` - `系统用户` 中配置系统用户（登录服务器的账户）\n+ 不要删除根节点(Default)\n\n##### Opscloud自动化配置\n+ oc中新增服务器会自动创建jumpserver资产\n+ 资产和资产组都会同步映射\n+ 用户授权了服务器组则会自动同步用户到jumpserver,并映射资产授权\n+ 用户在oc个人详情中保存pubkey会自动同步到jumpserver\n\n##### 使用问题\n+ koko名称不正确（请修改terminal表中name字段值），koko注册名称不正确导致"},"3a3b":function(e,t,n){"use strict";var s=n("0023"),a=n.n(s);a.a},"634f":function(e,t,n){},"95ff":function(e,t,n){"use strict";var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{title:e.title,visible:e.formStatus.visible,width:"80%","before-close":e.handlerCloseDialog},on:{"update:visible":function(t){return e.$set(e.formStatus,"visible",t)}}},[e._l(e.xterms,(function(t){return n("div",{key:t},[[n("el-col",{attrs:{span:24}},[n("el-card",{staticStyle:{"margin-right":"10px","margin-bottom":"10px"},attrs:{shadow:"hover","body-style":"padding: 2px"}},[n("div",{staticClass:"clearfix",staticStyle:{height:"15px"},attrs:{slot:"header"},slot:"header"},[n("span",[n("el-tag",[e._v(" "+e._s(t))])],1),n("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"退出",placement:"top-start"}},[n("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:function(n){return e.handlerLogout(t)}}},[e._v(" Logout ")])],1),n("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"复制会话",placement:"top-start"}},[n("el-button",{staticStyle:{float:"right",padding:"3px 0","margin-right":"20px"},attrs:{type:"text"},on:{click:function(t){return e.handlerDuplicateSession()}}},[e._v("Duplicate ")])],1)],1),n("div",{staticClass:"xterm",attrs:{id:t}})])],1)]],2)})),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{size:"mini"},on:{click:e.handlerExit}},[e._v("关闭")])],1)],2)},a=[],r=(n("4de4"),n("d81d"),n("b0c0"),n("1276"),n("c276")),i=(n("abb2"),n("fcf3")),o=n("47d0"),l=n("e232"),c="ws/xterm",u="XTERM",d={data:function(){return{title:"Web-XTerminal",socketURI:r["a"].wsUrl(c),server:{},addonMap:[],xterms:[],xtermMap:{},timer:null,xtermSize:{rows:30},xtermTheme:{foreground:"#FFFFFF",background:"#606266",cursor:"help"}}},name:"XTerm",props:["formStatus"],mixins:[],mounted:function(){this.setXTermSetting()},beforeDestroy:function(){try{for(var e in this.socket.close(),this.xtermMap)this.xtermMap[e].dispose()}catch(t){}clearInterval(this.timer)},methods:{setXTermSetting:function(){var e=this;Object(l["a"])(u).then((function(t){if(t.success)try{e.xtermTheme.foreground=t.body["XTERM_FOREGROUND"],e.xtermTheme.background=t.body["XTERM_BACKGROUND"],e.xtermSize.rows=t.body["XTERM_ROWS"]||30}catch(n){}else e.$message.error(t.msg)}))},handlerExit:function(){this.handlerClose();try{for(var e in this.socket.close(),this.xtermMap)this.xtermMap[e].dispose()}catch(t){}this.formStatus.visible=!1},initData:function(e){this.server=e,this.handlerLogin()},setTimer:function(){var e=this;this.timer=setInterval((function(){e.handlerSSHHeartbeat()}),1e4)},handlerSSHHeartbeat:function(){var e={status:"HEARTBEAT"};try{this.socketOnSend(JSON.stringify(e))}catch(t){}},initTermInstance:function(e){var t=this,n=e.name,s=new i["Terminal"]({rendererType:"canvas",allowTransparency:!0,fontSize:11,rows:this.xtermSize.rows,theme:this.xtermTheme,termName:"xterm",visualBell:!1,popOnBell:!1,scrollback:1e3,screenKeys:!1,debug:!1,cancelEvents:!1,cursorStyle:"underline",cursorBlink:!0,convertEol:!0});t.addonMap[n]=new o["FitAddon"],s.loadAddon(t.addonMap[n]),s.open(document.getElementById(n)),t.addonMap[n].fit(),s.focus(),s.onData((function(e){var s={data:e,status:"COMMAND",instanceId:n};t.socketOnSend(JSON.stringify(s))})),this.xtermMap[n]=s},handlerResize:function(){for(var e in this.xtermMap){this.addonMap[e].fit();var t={status:"RESIZE",instanceId:e,xtermWidth:7*this.addonMap[e]._terminal.cols,xtermHeight:document.getElementById(e).clientHeight};this.socketOnSend(JSON.stringify(t)),this.xtermMap[e].scrollToBottom()}},handlerDuplicateSession:function(){var e=this,t=this.server.name+"#"+r["a"].uuid(),n={status:"DUPLICATE_SESSION_IP",duplicateInstanceId:this.server.name,token:r["a"].cookies.get("token"),instanceId:t,xtermWidth:7*this.addonMap[t.split("#")[0]]._terminal.cols,xtermHeight:document.getElementById(t.split("#")[0]).clientHeight};this.xterms.push(t);var s={name:t,ip:this.server.privateIp};this.$nextTick((function(){e.initTermInstance(s),e.socketOnSend(JSON.stringify(n))}))},handlerLogout:function(e){var t={status:"LOGOUT",instanceId:e};this.socketOnSend(JSON.stringify(t));var n=this.xtermMap[e];n.dispose(),delete this.xtermMap[e],this.xterms=this.xterms.filter((function(t){return t!==e})),this.$message.warning(e+"终端已关闭")},handlerClose:function(){var e={status:"CLOSE"};this.socketOnSend(JSON.stringify(e)),this.xterms=[],this.xtermMap={},clearInterval(this.timer)},handlerCloseDialog:function(e){var t=this;this.$confirm("确定退出Web终端,并关闭所有会话?").then((function(n){e(),t.handlerExit()})).catch((function(e){}))},handlerLogin:function(){this.xtermMap={},this.initSocket(),this.setTimer()},initSocket:function(){this.socket=new WebSocket(this.socketURI),this.socketOnClose(),this.socketOnOpen(),this.socketOnError(),this.socketOnMessage()},socketOnOpen:function(){var e=this;this.socket.onopen=function(){try{e.xterms=[],e.xterms.push(e.server.name),e.$nextTick((function(){e.initTermInstance(e.server);var t={token:r["a"].cookies.get("token"),instanceId:e.server.name,ip:e.server.privateIp,status:"INITIAL_IP",xtermWidth:0,xtermHeight:308};e.socketOnSend(JSON.stringify(t)),e.$nextTick((function(){e.handlerResize()}))}))}catch(t){e.$message.error("登录失败，未选择服务器或其它原因")}}},socketOnClose:function(){this.socket.onclose=function(){}},socketOnError:function(){this.socket.onerror=function(){}},socketOnSend:function(e){this.socket.send(e)},socketOnMessage:function(){var e=this;this.socket.onmessage=function(t){var n=JSON.parse(t.data),s=e;n.map((function(e){s.xtermMap[e.instanceId].write(e.output)}))}}}},m=d,p=(n("0462"),n("2877")),h=function(e){e.options.__source="src/components/opscloud/xterm/XTerm.vue"},g=h,f=Object(p["a"])(m,s,a,!1,null,null,null);"function"===typeof g&&g(f);t["a"]=f.exports},9960:function(e,t,n){"use strict";n.r(t);var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("d2-container",[[n("div",[n("h1",[e._v(e._s(e.title))])]),n("el-col",[n("el-tabs",{staticStyle:{height:"200px"},attrs:{"tab-position":"top"}},[n("el-tab-pane",{attrs:{label:"设置面板"}},[n("el-row",{attrs:{gutter:20}},[n("el-col",{attrs:{span:10}},[n("el-card",{staticClass:"box-card",attrs:{shadow:"never"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[e._v("全局设置")]),n("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:e.saveSettings}},[e._v("保存")])],1),n("el-form",{attrs:{model:e.settings}},[n("el-tooltip",{attrs:{content:"推送权限的账户",placement:"top-start",effect:"light"}},[n("el-form-item",{attrs:{label:"管理账户","label-width":e.labelWidth,required:!0}},[[n("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.settings.assetsAdminuserId,callback:function(t){e.$set(e.settings,"assetsAdminuserId","string"===typeof t?t.trim():t)},expression:"settings.assetsAdminuserId"}},e._l(e.settings.assetsAdminusers,(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)]],2)],1),n("el-tooltip",{attrs:{content:"普通用户登录系统的账户(不支持sudo)",placement:"top-start",effect:"light"}},[n("el-form-item",{attrs:{label:"低权限系统账户","label-width":e.labelWidth,required:!0}},[[n("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.settings.assetsSystemuserId,callback:function(t){e.$set(e.settings,"assetsSystemuserId","string"===typeof t?t.trim():t)},expression:"settings.assetsSystemuserId"}},e._l(e.settings.assetsSystemusers,(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)]],2)],1),n("el-tooltip",{attrs:{content:"管理员登录系统的账户(支持sudo)",placement:"bottom",effect:"light"}},[n("el-form-item",{attrs:{label:"高权限系统账户","label-width":e.labelWidth,required:!0}},[[n("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.settings.assetsAdminSystemuserId,callback:function(t){e.$set(e.settings,"assetsAdminSystemuserId","string"===typeof t?t.trim():t)},expression:"settings.assetsAdminSystemuserId"}},e._l(e.settings.assetsSystemusers,(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)]],2)],1)],1)],1),n("div",{staticStyle:{margin:"15px 0"}}),n("el-card",{staticClass:"box-card",attrs:{shadow:"never"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[e._v("管理员")])]),n("div",{staticStyle:{"margin-bottom":"5px"}},[n("el-row",{staticStyle:{"margin-bottom":"5px"}},[n("el-select",{style:e.searchBarHeadStyle,attrs:{filterable:"",clearable:"",remote:"","reserve-keyword":"",placeholder:"搜索用户","remote-method":e.getUser,loading:e.searchUserLoading},model:{value:e.userId,callback:function(t){e.userId=t},expression:"userId"}},e._l(e.userOptions,(function(e){return n("el-option",{key:e.id,attrs:{label:e.username,value:e.id}})})),1),n("el-button",{style:e.searchBarStyle,attrs:{type:"success",plain:"",size:"mini",disabled:""==e.userId},on:{click:function(t){return e.setUserAdmin()}}},[e._v("授权 ")])],1)],1),n("el-row",{staticStyle:{"margin-bottom":"5px"}},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.adminUserLoading,expression:"adminUserLoading"}],staticStyle:{width:"100%"},attrs:{data:e.adminUserTableData}},[n("el-table-column",{attrs:{prop:"username",label:"用户名"}}),n("el-table-column",{attrs:{prop:"name",label:"显示名"}}),n("el-table-column",{attrs:{fixed:"right",label:"操作",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return["admin"!=t.row.username?n("el-button",{attrs:{type:"danger",plain:"",size:"mini"},on:{click:function(n){return e.revokeItem(t.row)}}},[e._v("撤销 ")]):e._e()]}}])})],1),n("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:e.adminUserPagination.total,"current-page":e.adminUserPagination.currentPage,"page-size":e.adminUserPagination.pageSize},on:{"current-change":e.adminUserPaginationCurrentChange}})],1)],1)],1),n("el-col",{attrs:{span:14}},[n("el-card",{staticClass:"box-card",attrs:{shadow:"never"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[e._v("终端(koko)")]),n("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:e.getTerminal}},[e._v("刷新")])],1),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.terminalLoding,expression:"terminalLoding"}],staticStyle:{width:"100%"},attrs:{data:e.terminals}},[n("el-table-column",{attrs:{prop:"name",label:"名称"}}),n("el-table-column",{attrs:{prop:"remoteAddr",label:"ip"}}),n("el-table-column",{attrs:{prop:"sshPort",label:"ssh"}}),n("el-table-column",{attrs:{prop:"httpPort",label:"http"}}),n("el-table-column",{attrs:{prop:"sessions",label:"会话"}}),n("el-table-column",{attrs:{fixed:"right",label:"操作",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:function(n){return e.handlerXTerm(t.row)}}},[e._v("登录")])]}}])})],1)],1)],1)],1)],1),n("el-tab-pane",{attrs:{label:"当前会话"}},[n("div",{staticStyle:{"margin-bottom":"5px"}},[n("el-row",{staticStyle:{"margin-bottom":"5px"}},[n("el-button",{style:e.searchBarStyle,on:{click:e.fetchTerminalSessionData}},[e._v("查询")])],1)],1),n("el-row",{staticStyle:{"margin-bottom":"5px"}},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.terminalSessionLoading,expression:"terminalSessionLoading"}],staticStyle:{width:"100%"},attrs:{data:e.terminalSessionTableData}},[n("el-table-column",{attrs:{prop:"user",label:"用户"}}),n("el-table-column",{attrs:{prop:"remoteAddr",label:"用户ip"}}),n("el-table-column",{attrs:{prop:"asset",label:"资产"}}),n("el-table-column",{attrs:{prop:"protocol",label:"协议"}}),n("el-table-column",{attrs:{prop:"systemUser",label:"系统账户"}}),n("el-table-column",{attrs:{prop:"terminalName",label:"终端名称"}}),n("el-table-column",{attrs:{prop:"dateStart",label:"会话开始时间"}})],1),n("el-pagination",{attrs:{background:"","page-sizes":[10,15,20,25,30],layout:"sizes, prev, pager, next",total:e.terminalSessionPagination.total,"current-page":e.terminalSessionPagination.currentPage,"page-size":e.terminalSessionPagination.pageSize},on:{"current-change":e.terminalSessionPaginationCurrentChange,"size-change":e.handleSizeChange}})],1)],1),n("el-tab-pane",{attrs:{label:"帮助"}},[n("d2-markdown",{attrs:{source:e.doc}})],1)],1)],1),n("XTerm",{ref:"xtermDialog",attrs:{formStatus:e.formXtermStatus}})]],2)},a=[],r=(n("a4d3"),n("4de4"),n("b0c0"),n("e439"),n("dbb4"),n("b64b"),n("159b"),n("ade3")),i=n("5880"),o=n("95ff"),l=n("14a3"),c=n.n(l),u=n("da4f"),d=n("11a2"),m=n("9f19"),p=n("9bd2");function h(){return Object(p["a"])({url:"/jump/jumpserver/settings/query",method:"get"})}function g(e){return Object(p["a"])({url:"/jump/jumpserver/settings/save",method:"post",data:e})}function f(){return Object(p["a"])({url:"/jump/jumpserver/terminal/query",method:"get"})}function b(e){return Object(p["a"])({url:"/jump/jumpserver/terminal/session/page/query",method:"post",data:e})}function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){Object(r["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var y={data:function(){return{formXtermStatus:{visible:!1},searchBarHeadStyle:{display:"inline-block",maxWidth:"200px"},searchBarStyle:{marginLeft:"5px"},adminUserTableData:[],adminUserLoading:!1,adminUserPagination:{currentPage:1,pageSize:10,total:0},queryAdminUserParam:{queryName:"",isAdmin:1},terminalSessionTableData:[],terminalSessionPagination:{currentPage:1,pageSize:10,total:0},terminalSessionLoading:!1,userOptions:[],userId:"",searchUserLoading:!1,labelWidth:"150px",settings:{},terminals:[],terminalLoding:!1,title:"Jumpserver控制面板",doc:c.a}},computed:S({},Object(i["mapState"])("d2admin/user",["info"])),mounted:function(){this.initPageSize(),this.getSettings(),this.getTerminal(),this.fetchAdminUserData(),this.fetchTerminalSessionData()},components:{XTerm:o["a"]},filters:{getUserRoleType:u["b"],getUserRoleText:u["a"],getActiveType:d["b"],getActiveText:d["a"]},methods:S({},Object(i["mapActions"])({setPageSize:"d2admin/user/set"}),{handleSizeChange:function(e){this.terminalSessionPagination.pageSize=e,this.info.pageSize=e,this.setPageSize(this.info),this.fetchTerminalSessionData()},initPageSize:function(){"undefined"!==typeof this.info.pageSize&&(this.terminalSessionPagination.pageSize=this.info.pageSize)},getUser:function(e){var t=this;this.searchUserLoading=!0;var n={queryName:e,isAdmin:0,page:1,length:20};Object(m["c"])(n).then((function(e){t.userOptions=e.body.data,t.searchUserLoading=!1}))},getSettings:function(){var e=this;h().then((function(t){e.settings=t.body}))},handlerXTerm:function(e){this.formXtermStatus.visible=!0;var t={name:e.name,privateIp:e.remoteAddr};this.$refs.xtermDialog.initData(t)},saveSettings:function(){var e=this;g(this.settings).then((function(t){t.success?(e.getSettings(),e.$message({type:"success",message:"设置成功!"})):e.$message({type:"warning",message:"设置失败!"})}))},setUserAdmin:function(){var e=this;Object(m["a"])(this.userId).then((function(t){t.success?(e.fetchAdminUserData(),e.$message({type:"success",message:"设置成功!"})):e.$message.error(t.msg),e.userId=""}))},revokeItem:function(e){var t=this;Object(m["e"])(e.id).then((function(e){e.success?(t.fetchAdminUserData(),t.$message({type:"success",message:"设置成功!"})):t.$message.error(e.msg)}))},getTerminal:function(){var e=this;this.terminalLoding=!0,f().then((function(t){e.terminals=t.body,e.terminalLoding=!1}))},adminUserPaginationCurrentChange:function(e){this.adminUserPagination.currentPage=e,this.fetchAdminUserData()},fetchAdminUserData:function(){var e=this;this.adminUserLoading=!0;var t=Object.assign({},this.queryAdminUserParam);t.page=this.adminUserPagination.currentPage,t.length=this.adminUserPagination.pageSize,Object(m["c"])(t).then((function(t){e.adminUserTableData=t.body.data,e.adminUserPagination.total=t.body.totalNum,e.adminUserLoading=!1}))},terminalSessionPaginationCurrentChange:function(e){this.terminalSessionPagination.currentPage=e,this.fetchTerminalSessionData()},fetchTerminalSessionData:function(){var e=this;this.terminalSessionLoading=!0;var t={page:this.terminalSessionPagination.currentPage,length:this.terminalSessionPagination.pageSize};b(t).then((function(t){e.terminalSessionTableData=t.body.data,e.terminalSessionPagination.total=t.body.totalNum,e.terminalSessionLoading=!1}))}})},x=y,k=(n("3a3b"),n("2877")),O=function(e){e.options.__source="src/pages/jump/jumpserver/settings/index.vue"},j=O,w=Object(k["a"])(x,s,a,!1,null,"35f5dd49",null);"function"===typeof j&&j(w);t["default"]=w.exports},"9f19":function(e,t,n){"use strict";n.d(t,"d",(function(){return a})),n.d(t,"g",(function(){return r})),n.d(t,"h",(function(){return i})),n.d(t,"f",(function(){return o})),n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return c})),n.d(t,"a",(function(){return u})),n.d(t,"e",(function(){return d}));var s=n("9bd2");function a(e){return Object(s["a"])({url:"/jump/jumpserver/user/page/fuzzy/query",method:"post",data:e})}function r(){return Object(s["a"])({url:"/jump/jumpserver/user/sync",method:"get"})}function i(e){return Object(s["a"])({url:"/jump/jumpserver/user/id/sync?id="+e,method:"get"})}function o(e){return Object(s["a"])({url:"/jump/jumpserver/user/active/set?id="+e,method:"get"})}function l(e){return Object(s["a"])({url:"/jump/jumpserver/user/del?username="+e,method:"delete"})}function c(e){return Object(s["a"])({url:"/jump/jumpserver/user/admin/page/fuzzy/query",method:"post",data:e})}function u(e){return Object(s["a"])({url:"/jump/jumpserver/user/admin/auth?id="+e,method:"get"})}function d(e){return Object(s["a"])({url:"/jump/jumpserver/user/admin/revoke?id="+e,method:"get"})}},da4f:function(e,t,n){"use strict";function s(e){switch(e){case"User":return"success";case"Auditor":return"warning";case"Admin":return"danger";default:return"info"}}function a(e){switch(e){case"User":return"用户";case"Auditor":return"审计员";case"Admin":return"管理员";default:return"未定义"}}n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return a}))}}]);