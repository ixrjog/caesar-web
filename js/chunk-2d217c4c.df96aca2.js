(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d217c4c"],{c7ac:function(e,t,o){"use strict";o.r(t);var a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("d2-container",[[o("div",[o("h1",[e._v("Playbook")])]),o("el-row",{attrs:{gutter:10}},[o("el-col",{attrs:{span:8}},[o("ServerTree",{ref:"serverTree"})],1),o("el-col",{attrs:{span:16}},[o("el-select",{style:e.searchBarStyle,attrs:{filterable:"","value-key":"id","reserve-keyword":"",remote:"",placeholder:"搜索playbook","remote-method":e.getPlaybook,loading:e.playbookSearching},on:{change:e.selectPlaybook},model:{value:e.playbook,callback:function(t){e.playbook="string"===typeof t?t.trim():t},expression:"playbook"}},e._l(e.playbookOptions,(function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e}})})),1),o("el-tooltip",{attrs:{content:"预览playbook脚本",placement:"bottom",effect:"light"}},[o("el-button",{style:e.searchBarStyle,on:{click:e.previewPlaybook}},[e._v("预览")])],1),o("el-tooltip",{attrs:{content:"批量命令执行",placement:"bottom",effect:"light"}},[o("el-button",{style:e.searchBarStyle,on:{click:e.executorPlaybook}},[e._v("执行")])],1),o("el-form",{attrs:{model:e.executorPlaybookParam}},[o("el-form-item",{staticStyle:{"max-width":"400px","margin-top":"5px"},attrs:{label:"并发线程数","label-width":e.labelWidth,required:!0}},[o("el-slider",{attrs:{min:2,max:40,step:2,"show-stops":""},model:{value:e.executorPlaybookParam.concurrent,callback:function(t){e.$set(e.executorPlaybookParam,"concurrent",t)},expression:"executorPlaybookParam.concurrent"}})],1),null!=e.playbook&&null!=e.playbook.selectedTags?o("el-form-item",{staticStyle:{"max-width":"800px","margin-top":"5px"},attrs:{label:"tags","label-width":e.labelWidth}},[o("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:e.playbook.selectedTags,callback:function(t){e.$set(e.playbook,"selectedTags",t)},expression:"playbook.selectedTags"}},e._l(e.playbook.tasks,(function(t){return o("el-option",{key:t.tags,attrs:{label:t.tags,value:t.tags}},[o("span",{staticStyle:{float:"left"}},[e._v(e._s(t.tags))]),o("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.name))])])})),1)],1):e._e(),null!=e.playbook&&null!=e.playbook.extraVars?o("el-form-item",{staticStyle:{"max-width":"400px","margin-top":"5px"},attrs:{label:"vars","label-width":e.labelWidth}},[o("el-tooltip",{attrs:{content:"自定义外部变量",placement:"bottom",effect:"light"}},[o("editor",{attrs:{lang:"yaml",theme:"chrome",width:"400",height:"100",options:e.options},on:{init:e.editorInit},model:{value:e.playbook.extraVars,callback:function(t){e.$set(e.playbook,"extraVars",t)},expression:"playbook.extraVars"}})],1)],1):e._e()],1),o("AnsibleResult",{ref:"ansibleResult"})],1)],1),o("PreviewContentDialog",{ref:"previewDialog",attrs:{formStatus:e.formPreviewStatus}})]],2)},l=[],s=(o("b0c0"),o("c8c3")),r=o("ae11"),i=o("ebec"),n=o("67ee"),c={data:function(){return{serverTask:"",taskId:"",searchBarHeadStyle:{display:"inline-block",maxWidth:"200px"},searchBarStyle:{marginLeft:"5px"},uuid:"",options:{stripe:!0},executorPlaybookParam:{playbookId:"",vars:"",tags:[],concurrent:10,becomeUser:"",hostPatterns:[],uuid:"",taskType:2},playbookSearching:!1,playbook:{},playbookOptions:[],labelWidth:"100px",formPreviewStatus:{visible:!1,labelWidth:"100px"}}},mounted:function(){this.getPlaybook("")},components:{ServerTree:s["a"],PreviewContentDialog:r["a"],AnsibleResult:i["a"],editor:o("7c9e")},methods:{selectPlaybook:function(e){this.playbook=e||{}},getPlaybook:function(e){var t=this;this.playbookSearching=!0;var o={queryName:e,page:1,length:20};Object(n["m"])(o).then((function(e){t.playbookOptions=e.body.data,t.playbookSearching=!1}))},previewPlaybook:function(){var e={name:this.playbook.name,content:this.playbook.playbook,path:this.playbook.path,lang:"yaml",comment:this.playbook.comment};this.formPreviewStatus.visible=!0,this.$refs.previewDialog.initData(e)},editorInit:function(){o("2099"),o("2968"),o("446e"),o("95b8"),o("ec5e")},executorPlaybook:function(){var e=this,t=Object.assign({},this.executorPlaybookParam);try{if(t.hostPatterns=this.$refs.serverTree.getCheckedKeys(!0),t.uuid=this.$refs.serverTree.getUuid(),"[]"===JSON.stringify(t.hostPatterns))return void this.$message.error("未选择服务器节点")}catch(o){return void this.$message.error("服务器节点查询失败")}"{}"!==JSON.stringify(this.playbook)?(t.playbookId=this.playbook.id,t.vars=this.playbook.extraVars,t.tags=this.playbook.selectedTags,Object(n["i"])(t).then((function(t){t.success?(e.$message({message:"任务执行中!",type:"success"}),e.$refs.ansibleResult.initData(t.body.id)):e.$message.error(t.msg)}))):this.$message.error("未选择playbook")}}},p=c,b=o("2877"),y=function(e){e.options.__source="src/pages/task/playbook/index.vue"},u=y,k=Object(b["a"])(p,a,l,!1,null,null,null);"function"===typeof u&&u(k);t["default"]=k.exports}}]);