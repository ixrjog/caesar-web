(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c823ac82"],{"078d":function(e,t,n){"use strict";var a=n("b819"),s=n.n(a);s.a},"28da":function(e,t,n){"use strict";var a=n("844b"),s=n.n(a);s.a},8409:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("d2-container",[[n("div",[n("h1",[e._v(e._s(e.title))])]),n("el-row",{staticStyle:{"margin-bottom":"5px"},attrs:{gutter:24}},[n("el-col",{attrs:{span:12}},[n("el-card",{attrs:{shadow:"never"}},[n("XTermSessionTable",{ref:"xtermSessionTable",on:{handlerSelSession:e.handlerSelSession}})],1)],1),n("el-col",{attrs:{span:12}},[n("el-card",{attrs:{shadow:"never"}},[n("XTermSessionInstanceTable",{ref:"xtermSessionInstanceTable"})],1)],1)],1)]],2)},s=[],i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-row",{staticStyle:{"margin-bottom":"5px"},attrs:{gutter:24}},[n("el-input",{staticClass:"input-bar",attrs:{placeholder:"用户名查询"},model:{value:e.queryParam.username,callback:function(t){e.$set(e.queryParam,"username","string"===typeof t?t.trim():t)},expression:"queryParam.username"}}),n("el-select",{staticClass:"select-bar",attrs:{clearable:"",placeholder:"会话"},model:{value:e.queryParam.isClosed,callback:function(t){e.$set(e.queryParam,"isClosed","string"===typeof t?t.trim():t)},expression:"queryParam.isClosed"}},e._l(e.closeOptions,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),n("el-button",{staticClass:"buuton",on:{click:e.fetchData}},[e._v("查询")])],1),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData}},[n("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-form",{staticClass:"table-expand",attrs:{"label-position":"left",inline:""}},[n("el-form-item",{attrs:{label:"会话id"}},[n("span",[e._v(e._s(t.row.sessionId))])])],1)]}}])}),n("el-table-column",{attrs:{prop:"username",label:"用户名"}}),n("el-table-column",{attrs:{prop:"sessionInstances",label:"会话实例"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-tag",{attrs:{type:0===t.row.sessionInstances.length?"info":""}},[e._v(e._s(null===t.row.sessionInstances?0:t.row.sessionInstances.length)+" ")])]}}])}),n("el-table-column",{attrs:{prop:"isClosed",label:"会话状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-tag",{attrs:{type:t.row.isClosed?"info":"success"}},[e._v(e._s(t.row.isClosed?"已关闭":"活跃"))])]}}])}),n("el-table-column",{attrs:{prop:"closeTime",label:"关闭时间"}}),n("el-table-column",{attrs:{fixed:"right",label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:function(n){return e.handlerSetSessionInstances(t.row)}}},[e._v("查看 ")])]}}])})],1),n("el-pagination",{attrs:{background:"","page-sizes":[10,15,20,25,30],layout:"sizes, prev, pager, next",total:e.pagination.total,"current-page":e.pagination.currentPage,"page-size":e.pagination.pageSize},on:{"current-change":e.paginationCurrentChange,"size-change":e.handleSizeChange}})],1)},o=[],r=(n("a4d3"),n("4de4"),n("e439"),n("dbb4"),n("b64b"),n("159b"),n("ade3")),l=n("5880"),c=n("9bd2");function u(e){return Object(c["a"])({url:"/term/session/page/query",method:"post",data:e})}function d(e){return Object(c["a"])({url:"/term/session/instance/query?id="+e,method:"get"})}function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){Object(r["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var f=[{value:!1,label:"活跃会话"},{value:!0,label:"已关闭会话"}],b={name:"XTermSessionTable",data:function(){return{formStatus:{visible:!1},tableData:[],loading:!1,pagination:{currentPage:1,pageSize:10,total:0},queryParam:{uername:"",isClosed:null,extend:1},title:"终端会话管理",closeOptions:f}},computed:m({},Object(l["mapState"])("d2admin/user",["info"])),mounted:function(){this.initPageSize(),this.fetchData()},methods:m({},Object(l["mapActions"])({setPageSize:"d2admin/user/set"}),{handleSizeChange:function(e){this.pagination.pageSize=e,this.info.pageSize=e,this.setPageSize(this.info),this.fetchData()},initPageSize:function(){"undefined"!==typeof this.info.pageSize&&(this.pagination.pageSize=this.info.pageSize)},handlerPreviewAuditLog:function(e){this.$refs.previewTermAuditLogDialog.initData(e.id),this.formStatus.visible=!0},handlerSetSessionInstances:function(e){this.$emit("handlerSelSession",e.sessionInstances)},paginationCurrentChange:function(e){this.pagination.currentPage=e,this.fetchData()},fetchData:function(){var e=this;this.loading=!0;var t=Object.assign({},this.queryParam);t.page=this.pagination.currentPage,t.length=this.pagination.pageSize,u(t).then((function(t){e.tableData=t.body.data,e.pagination.total=t.body.totalNum,e.loading=!1}))}})},g=b,h=(n("078d"),n("2877")),v=function(e){e.options.__source="src/components/opscloud/xterm/XTermSessionTable.vue"},S=v,y=Object(h["a"])(g,i,o,!1,null,"46b8ba1e",null);"function"===typeof S&&S(y);var w=y.exports,_=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.sessionInstances}},[n("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-form",{staticClass:"table-expand",attrs:{"label-position":"left",inline:""}},[n("el-form-item",{attrs:{label:"会话id"}},[n("span",[e._v(e._s(t.row.sessionId))])])],1)]}}])}),n("el-table-column",{attrs:{prop:"instanceId",label:"实例id"}}),n("el-table-column",{attrs:{prop:"hostIp",label:"主机"}}),n("el-table-column",{attrs:{prop:"isClosed",label:"会话状态",width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-tag",{attrs:{type:t.row.isClosed?"info":"success"}},[e._v(e._s(t.row.isClosed?"已关闭":"活跃")+" ")])]}}])}),n("el-table-column",{attrs:{prop:"outputFileSize",label:"日志",width:"80px"}}),n("el-table-column",{attrs:{prop:"closeTime",label:"关闭时间"}}),n("el-table-column",{attrs:{fixed:"right",label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.auditLog.isEmpty?e._e():n("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:function(n){return e.handlerPreviewAuditLog(t.row)}}},[e._v("日志 ")])]}}])})],1),n("PreviewTermAuditLogDialog",{ref:"previewTermAuditLogDialog",attrs:{formStatus:e.formStatus}})],1)},T=[],x=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{title:e.title,visible:e.formStatus.visible,"before-close":e.handlerCloseDialog},on:{"update:visible":function(t){return e.$set(e.formStatus,"visible",t)}}},[n("el-col",{attrs:{span:24}},[n("el-card",{staticStyle:{"margin-right":"10px","margin-bottom":"10px"},attrs:{shadow:"hover","body-style":"padding: 2px"}},[n("div",{staticClass:"clearfix",staticStyle:{height:"15px"},attrs:{slot:"header"},slot:"header"},[n("span",[n("el-tag",[e._v(e._s(e.sessionInstance.instanceId))])],1)]),n("div",{staticClass:"xterm",attrs:{id:"auditXterm"}})])],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{size:"mini"},on:{click:e.handlerCloseDialog}},[e._v("关闭")])],1)],1)},O=[],P=(n("abb2"),n("fcf3")),D=n("47d0"),C=n("e232"),I="XTERM",k={data:function(){return{title:"审计日志",xterm:"auditXterm",term:null,sessionInstance:"",labelWidth:"100px",xtermTheme:{foreground:"#FFFFFF",background:"#606266",cursor:"help"}}},name:"PreviewTermAuditLogDialog",props:["formStatus"],mixins:[],mounted:function(){this.setXTermSetting()},methods:{setXTermSetting:function(){var e=this;Object(C["a"])(I).then((function(t){if(t.success)try{e.xtermTheme.foreground=t.body["XTERM_FOREGROUND"],e.xtermTheme.background=t.body["XTERM_BACKGROUND"]}catch(n){}else e.$message.error(t.msg)}))},handlerCloseDialog:function(){this.sessionInstance="",this.term.dispose(),this.term="",this.formStatus.visible=!1},initData:function(e){var t=this;d(e).then((function(e){t.sessionInstance=e.body,t.handlerAuditLog()}))},handlerAuditLog:function(){var e=new P["Terminal"]({rendererType:"canvas",allowTransparency:!0,fontSize:11,theme:this.xtermTheme,termName:"xterm",visualBell:!1,popOnBell:!1,scrollback:1e3,screenKeys:!1,debug:!1,cancelEvents:!1,cursorStyle:"bar",cursorBlink:!1,convertEol:!0,disableStdin:!0}),t=new D["FitAddon"];e.loadAddon(t),e.open(document.getElementById("auditXterm")),e.write(this.sessionInstance.auditLog.content),t.fit(),e.focus(),this.term=e}}},z=k,j=(n("28da"),function(e){e.options.__source="src/components/opscloud/dialog/PreviewTermAuditLogDialog.vue"}),A=j,X=Object(h["a"])(z,x,O,!1,null,null,null);"function"===typeof A&&A(X);var E=X.exports,L=[{value:!1,label:"活跃会话"},{value:!0,label:"已关闭会话"}],$={name:"XTermInstanceTable",data:function(){return{formStatus:{visible:!1},sessionInstances:[],loading:!1,title:"终端会话管理",closeOptions:L}},components:{PreviewTermAuditLogDialog:E},methods:{initData:function(e){this.sessionInstances=e},handlerPreviewAuditLog:function(e){this.$refs.previewTermAuditLogDialog.initData(e.id),this.formStatus.visible=!0}}},q=$,F=function(e){e.options.__source="src/components/opscloud/xterm/XTermSessionInstanceTable.vue"},R=F,B=Object(h["a"])(q,_,T,!1,null,"8c5ebf8c",null);"function"===typeof R&&R(B);var N=B.exports,M={data:function(){return{title:"终端会话管理"}},computed:{},mounted:function(){},components:{XTermSessionTable:w,XTermSessionInstanceTable:N},methods:{handlerSelSession:function(e){this.$refs.xtermSessionInstanceTable.initData(e)}}},G=M,J=function(e){e.options.__source="src/pages/term/session/index.vue"},K=J,U=Object(h["a"])(G,a,s,!1,null,null,null);"function"===typeof K&&K(U);t["default"]=U.exports},"844b":function(e,t,n){},b819:function(e,t,n){}}]);